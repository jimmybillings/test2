"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var search_component_1 = require("./search.component");
var Observable_1 = require("rxjs/Observable");
var mock_app_store_1 = require("../store/spec-helpers/mock-app.store");
function main() {
    describe('Search Component', function () {
        var componentUnderTest;
        var mockSearchService;
        var mockUserCan;
        var mockSearchContext;
        var mockFilter;
        var mockUserPreferences;
        var mockSortDefinition;
        var mockCart;
        var mockAssetService;
        var mockRenderer;
        var mockWindow;
        var mockRouter;
        var mockActivatedRoute;
        var mockRefDetector;
        var mockStore;
        var searchResetDispatchSpy;
        var canEditCollection;
        var confirmationDialogDispatchSpy;
        beforeEach(function () {
            mockUserCan = {
                administerQuotes: function () { return false; },
                editCollection: function () { return Observable_1.Observable.of(canEditCollection); }
            };
            mockSearchContext = {
                update: null,
                go: jasmine.createSpy('go'),
                remove: jasmine.createSpy('remove'),
                state: {
                    q: 'cat', i: 7, n: 100, sortId: 23, filterIds: '1517',
                    filterValues: '1517:2015-12-10 - 2016-12-12'
                }
            };
            mockFilter = {
                load: jasmine.createSpy('load').and.returnValue(Observable_1.Observable.of([])),
                set: jasmine.createSpy('set'),
                active: jasmine.createSpy('active'),
                toggle: jasmine.createSpy('toggle'),
                getActive: jasmine.createSpy('getActive').and.returnValue({ filters: [{ filterId: 1 }, { filterId: 2 }, { filterId: 3, filterValue: 'Cat' }], ids: [1, 2, 3], values: ['Cat'] }),
                addCustom: jasmine.createSpy('addCustom'),
                toggleExclusive: jasmine.createSpy('toggleExclusive'),
                clear: jasmine.createSpy('clear'),
                toggleFilterGroup: jasmine.createSpy('toggleFilterGroup')
            };
            mockUserPreferences = {
                data: Observable_1.Observable.of({ displayFilterCounts: false, displayFilterTree: true }),
                toggleFilterCount: jasmine.createSpy('toggleFilterCount'),
                openCollectionTray: jasmine.createSpy('openCollectionTray'),
                updateSortPreference: jasmine.createSpy('updateSortPreference'),
                state: { displayFilterCounts: false, displayFilterTree: true },
                updateAssetViewPreference: jasmine.createSpy('updateAssetViewPreference')
            };
            mockSortDefinition = {
                updateSortPreference: jasmine.createSpy('updateSortPreference'),
                update: jasmine.createSpy('update'),
                data: Observable_1.Observable.of({ currentSort: 'mockSort' })
            };
            mockCart = {
                addAssetToProjectInCart: jasmine.createSpy('addAssetToProjectInCart')
            };
            mockWindow = {
                nativeWindow: {
                    location: { href: null },
                    innerWidth: 500
                }
            };
            mockActivatedRoute = {
                snapshot: {
                    params: {
                        gq: '[{"ids":[13,18],"names":["press packet","day 04"]},{"ids":[3],"names":["adam scott"]}]',
                        n: 1,
                        i: 100
                    }
                }
            };
            mockRouter = {
                navigate: jasmine.createSpy('navigate'),
                events: Observable_1.Observable.of({})
            };
            mockRefDetector = {
                markForCheck: function () { return true; }
            };
            mockStore = new mock_app_store_1.MockAppStore();
            searchResetDispatchSpy = mockStore.createActionFactoryMethod('search', 'reset');
            confirmationDialogDispatchSpy = mockStore.createActionFactoryMethod('dialog', 'showConfirmation');
            componentUnderTest = new search_component_1.SearchComponent(mockUserCan, mockFilter, mockCart, mockSortDefinition, mockSearchContext, mockUserPreferences, mockWindow, mockActivatedRoute, mockRouter, mockRefDetector, mockStore);
        });
        describe('constructor()', function () {
            it('should not set the path if the "gq" parameter doesn\'t exist', function () {
                mockActivatedRoute = { snapshot: { params: { i: 1, n: 100 } } };
                componentUnderTest = new search_component_1.SearchComponent(mockUserCan, mockFilter, mockCart, mockSortDefinition, mockSearchContext, mockUserPreferences, mockWindow, mockActivatedRoute, mockRouter, mockRefDetector, mockStore);
                expect(componentUnderTest.path).toEqual('');
            });
            it('should set the path if there is a "gq" parameter', function () {
                expect(componentUnderTest.path).toEqual([
                    { 'ids': [13, 18], 'names': ['press packet', 'day 04'] },
                    { 'ids': [3], 'names': ['adam scott'] }
                ]);
            });
            it('returns observable of true when the \'filtersAreAvailable\'in the store is true', function () {
                mockStore.createStateSection('headerDisplayOptions', { filtersAreAvailable: true });
                componentUnderTest = new search_component_1.SearchComponent(mockUserCan, mockFilter, mockCart, mockSortDefinition, mockSearchContext, mockUserPreferences, mockWindow, mockActivatedRoute, mockRouter, mockRefDetector, mockStore);
                var areAvailable;
                componentUnderTest.filtersAreAvailable.take(1).subscribe(function (available) { return areAvailable = available; });
                expect(areAvailable).toBe(true);
            });
        });
        describe('onCLickBreadcrumb()', function () {
            it('should append to the path and call router.navigate()', function () {
                componentUnderTest.path = [
                    { 'ids': [13, 18], 'names': ['press packet', 'day 04'] },
                    { 'ids': [3], 'names': ['adam scott'] }
                ];
                componentUnderTest.onClickBreadcrumb(1);
                expect(mockRouter.navigate).toHaveBeenCalledWith([
                    '/gallery-view',
                    { path: '[{"ids":[13,18],"names":["press packet","day 04"]}]' }
                ]);
            });
        });
        describe('onresize()', function () {
            it('Should set the screen size variable when screen size change', function () {
                mockWindow.nativeWindow.onresize();
                expect(componentUnderTest.screenWidth).toBe(500);
            });
        });
        describe('ngOnDestroy()', function () {
            it('dispatch the search reset action', function () {
                componentUnderTest.ngOnDestroy();
                mockStore.expectDispatchFor(searchResetDispatchSpy);
            });
        });
        describe('countToggle()', function () {
            it('Should call the filter service get with the search context state and the opposite boolean value' +
                +' of the current displayFilterCounts boolean', function () {
                componentUnderTest.countToggle();
                expect(componentUnderTest.filter.load).toHaveBeenCalledWith({ q: 'cat', i: 7, n: 100, sortId: 23, filterIds: '1517', filterValues: '1517:2015-12-10 - 2016-12-12' }, true);
            });
            it('Should call the user preference service to toggle the filter count boolean', function () {
                componentUnderTest.countToggle();
                expect(mockUserPreferences.toggleFilterCount).toHaveBeenCalled();
            });
        });
        describe('changePage()', function () {
            it('Should call the update setter on search context to update the search context state', function () {
                componentUnderTest.changePage(1);
                expect(mockSearchContext.update).toEqual({ i: 1 });
            });
            it('Should call the go method on searchContext', function () {
                componentUnderTest.changePage(1);
                expect(mockSearchContext.go).toHaveBeenCalled();
            });
        });
        describe('filterEvent()', function () {
            it('Should call the filter service with a filter id to toggle its boolean on/off value', function () {
                componentUnderTest.filterEvent({ event: 'toggleFilter', filter: { filterId: 1 } });
                expect(componentUnderTest.filter.toggle).toHaveBeenCalledWith(1);
                expect(mockSearchContext.go).toHaveBeenCalled();
            });
            it('Should call the filter service to toggle a filter group to show/hide', function () {
                componentUnderTest.filterEvent({ event: 'toggleFilterGroup', filter: { filterId: 1 } });
                expect(componentUnderTest.filter.toggleFilterGroup).toHaveBeenCalledWith({ filterId: 1 });
            });
            it('Should call the filter service to apply an exculsive filter', function () {
                componentUnderTest.filterEvent({ event: 'applyExclusiveFilter', filter: { filterId: 1 } });
                expect(componentUnderTest.filter.toggleExclusive).toHaveBeenCalledWith({ filterId: 1 });
                expect(mockSearchContext.go).toHaveBeenCalled();
            });
            it('Should call the filter service to apply a custom value on a filter', function () {
                componentUnderTest.filterEvent({ event: 'applyCustomValue', filter: { filterId: 1 }, customValue: 'mockCustomValue' });
                expect(componentUnderTest.filter.addCustom).toHaveBeenCalledWith({ filterId: 1 }, 'mockCustomValue');
                expect(mockSearchContext.go).toHaveBeenCalled();
            });
            it('Should call the filter service to clear all filters / reset', function () {
                componentUnderTest.filterEvent({ event: 'clearFilters', filter: { filterId: 1 } });
                expect(componentUnderTest.filter.clear).toHaveBeenCalled();
                expect(mockSearchContext.go).toHaveBeenCalled();
            });
        });
        describe('onSortResults()', function () {
            it('Should call the user preference service to update the user sort preference', function () {
                componentUnderTest.sortResults({ id: 'sortByDate' });
                expect(mockUserPreferences.updateSortPreference).toHaveBeenCalledWith('sortByDate');
            });
            it('Should call sort definition service to update with new sort', function () {
                componentUnderTest.sortResults({ id: 'sortByDate' });
                expect(mockSortDefinition.update).toHaveBeenCalledWith({ currentSort: { id: 'sortByDate' } });
            });
            it('Should call the search context service to update the store with the new sort preference for the url', function () {
                componentUnderTest.sortResults({ id: 'sortByDate' });
                expect(mockSearchContext.update).toEqual({ 'i': 1, 'sortId': 'sortByDate' });
            });
            it('Should call the search context service to exectue and new browser url', function () {
                componentUnderTest.sortResults({ id: 'sortByDate' });
                expect(mockSearchContext.go).toHaveBeenCalled();
            });
        });
        describe('changeAssetView()', function () {
            it('Should update user preference when new view type is selected', function () {
                componentUnderTest.changeAssetView('list');
                expect(mockUserPreferences.updateAssetViewPreference).toHaveBeenCalledWith('list');
            });
        });
        describe('addAssetToCart()', function () {
            it('Should call the cart summary service to add an asset to the cart', function () {
                componentUnderTest.addAssetToCart({ assetId: 'mockId' });
                expect(mockCart.addAssetToProjectInCart).toHaveBeenCalledWith({ lineItem: { asset: { assetId: 'mockId' } } });
            });
        });
        describe('filterAssets()', function () {
            it('Should reset the page number to page 1', function () {
                mockFilter.getActive = jasmine.createSpy('getActive').and.returnValue({ filters: [], ids: [], values: [] });
                componentUnderTest = new search_component_1.SearchComponent(mockUserCan, mockFilter, mockCart, mockSortDefinition, mockSearchContext, mockUserPreferences, mockWindow, mockActivatedRoute, mockRouter, mockRefDetector, mockStore);
                componentUnderTest.filterEvent({ event: 'clearFilters', filter: { filterId: 1 } });
                expect(mockSearchContext.update).toEqual({ i: 1 });
            });
            it('Should update the search context with the filter ids', function () {
                mockFilter.getActive = jasmine.createSpy('getActive').and.returnValue({ filters: [], ids: [1, 2, 3], values: [] });
                componentUnderTest = new search_component_1.SearchComponent(mockUserCan, mockFilter, mockCart, mockSortDefinition, mockSearchContext, mockUserPreferences, mockWindow, mockActivatedRoute, mockRouter, mockRefDetector, mockStore);
                componentUnderTest.filterEvent({ event: 'clearFilters', filter: { filterId: 1 } });
                expect(mockSearchContext.update).toEqual({ 'filterIds': '1,2,3' });
            });
            it('Should remove the filterIds from the search context', function () {
                mockFilter.getActive = jasmine.createSpy('getActive').and.returnValue({ filters: [], ids: [], values: ['cat', 'dog'] });
                componentUnderTest = new search_component_1.SearchComponent(mockUserCan, mockFilter, mockCart, mockSortDefinition, mockSearchContext, mockUserPreferences, mockWindow, mockActivatedRoute, mockRouter, mockRefDetector, mockStore);
                componentUnderTest.filterEvent({ event: 'clearFilters', filter: { filterId: 1 } });
                expect(mockSearchContext.remove).toEqual('filterIds');
            });
            it('Should update the search context with the filter values', function () {
                mockFilter.getActive = jasmine.createSpy('getActive').and.returnValue({ filters: [], ids: [], values: ['cat', 'dog'] });
                componentUnderTest = new search_component_1.SearchComponent(mockUserCan, mockFilter, mockCart, mockSortDefinition, mockSearchContext, mockUserPreferences, mockWindow, mockActivatedRoute, mockRouter, mockRefDetector, mockStore);
                componentUnderTest.filterEvent({ event: 'clearFilters', filter: { filterId: 1 } });
                expect(mockSearchContext.update).toEqual({ 'filterValues': 'cat,dog' });
            });
            it('Should remove the filterValues from the search context', function () {
                mockFilter.getActive = jasmine.createSpy('getActive').and.returnValue({ filters: [], ids: [], values: [] });
                componentUnderTest = new search_component_1.SearchComponent(mockUserCan, mockFilter, mockCart, mockSortDefinition, mockSearchContext, mockUserPreferences, mockWindow, mockActivatedRoute, mockRouter, mockRefDetector, mockStore);
                componentUnderTest.filterEvent({ event: 'clearFilters', filter: { filterId: 1 } });
                expect(mockSearchContext.remove).toEqual('filterValues');
            });
            it('Should call go on search context when it has filtered the assets', function () {
                mockFilter.getActive = jasmine.createSpy('getActive').and.returnValue({ filters: [], ids: [], values: [] });
                componentUnderTest = new search_component_1.SearchComponent(mockUserCan, mockFilter, mockCart, mockSortDefinition, mockSearchContext, mockUserPreferences, mockWindow, mockActivatedRoute, mockRouter, mockRefDetector, mockStore);
                componentUnderTest.filterEvent({ event: 'clearFilters', filter: { filterId: 1 } });
                expect(mockSearchContext.go).toHaveBeenCalled();
            });
        });
        describe('canEditCollection()', function () {
            beforeEach(function () {
                mockStore.createStateSection('activeCollection', { collection: { some: 'collection' } });
            });
            it('returns true if userCan.editCollection() returns true', function () {
                canEditCollection = true;
                var result;
                componentUnderTest.canEditCollection.take(1).subscribe(function (res) { return result = res; });
                expect(result).toBe(true);
            });
            it('returns false if userCan.editCollection() returns false', function () {
                canEditCollection = false;
                var result;
                componentUnderTest.canEditCollection.take(1).subscribe(function (res) { return result = res; });
                expect(result).toBe(false);
            });
        });
        describe('onClickAddAllBtn()', function () {
            it('dispatches the proper action', function () {
                mockStore.createStateSection('activeCollection', { collection: { name: 'some collection' } });
                componentUnderTest.onClickAddAllBtn();
                mockStore.expectDispatchFor(confirmationDialogDispatchSpy, {
                    title: { key: 'SEARCH.ADD_ALL_TO_COLLECTION.CONFIRM.TITLE', values: { collectionName: 'some collection' } },
                    message: { key: 'SEARCH.ADD_ALL_TO_COLLECTION.CONFIRM.MESSAGE', values: { collectionName: 'some collection' } },
                    accept: 'SEARCH.ADD_ALL_TO_COLLECTION.CONFIRM.ACCEPT',
                    decline: 'SEARCH.ADD_ALL_TO_COLLECTION.CONFIRM.DECLINE'
                }, jasmine.any(Function));
            });
        });
    });
}
exports.main = main;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC8rc2VhcmNoL3NlYXJjaC5jb21wb25lbnQuc3BlYy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLHVEQUFxRDtBQUNyRCw4Q0FBNkM7QUFDN0MsdUVBQW9FO0FBRXBFO0lBQ0UsUUFBUSxDQUFDLGtCQUFrQixFQUFFO1FBQzNCLElBQUksa0JBQW1DLENBQUM7UUFDeEMsSUFBSSxpQkFBc0IsQ0FBQztRQUMzQixJQUFJLFdBQWdCLENBQUM7UUFDckIsSUFBSSxpQkFBc0IsQ0FBQztRQUMzQixJQUFJLFVBQWUsQ0FBQztRQUNwQixJQUFJLG1CQUF3QixDQUFDO1FBQzdCLElBQUksa0JBQXVCLENBQUM7UUFDNUIsSUFBSSxRQUFhLENBQUM7UUFDbEIsSUFBSSxnQkFBcUIsQ0FBQztRQUMxQixJQUFJLFlBQWlCLENBQUM7UUFDdEIsSUFBSSxVQUFlLENBQUM7UUFDcEIsSUFBSSxVQUFlLENBQUM7UUFDcEIsSUFBSSxrQkFBdUIsQ0FBQztRQUM1QixJQUFJLGVBQW9CLENBQUM7UUFDekIsSUFBSSxTQUF1QixDQUFDO1FBQzVCLElBQUksc0JBQW1DLENBQUM7UUFDeEMsSUFBSSxpQkFBMEIsQ0FBQztRQUMvQixJQUFJLDZCQUEwQyxDQUFDO1FBRS9DLFVBQVUsQ0FBQztZQUNULFdBQVcsR0FBRztnQkFDWixnQkFBZ0IsRUFBRSxjQUFNLE9BQUEsS0FBSyxFQUFMLENBQUs7Z0JBQzdCLGNBQWMsRUFBRSxjQUFNLE9BQUEsdUJBQVUsQ0FBQyxFQUFFLENBQUMsaUJBQWlCLENBQUMsRUFBaEMsQ0FBZ0M7YUFDdkQsQ0FBQztZQUVGLGlCQUFpQixHQUFHO2dCQUNsQixNQUFNLEVBQUUsSUFBSTtnQkFDWixFQUFFLEVBQUUsT0FBTyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUM7Z0JBQzNCLE1BQU0sRUFBRSxPQUFPLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQztnQkFDbkMsS0FBSyxFQUFFO29CQUNMLENBQUMsRUFBRSxLQUFLLEVBQUUsQ0FBQyxF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QUFFO29CQUMzRyxPQUFPLEVBQUUsRUFBRSxHQUFHLEVBQUUsOENBQThDLEVBQUUsTUFBTSxFQUFFLEVBQUUsY0FBYyxFQUFFLGlCQUFpQixFQUFFLEVBQUU7b0JBQy9HLE1BQU0sRUFBRSw2Q0FBNkM7b0JBQ3JELE9BQU8sRUFBRSw4Q0FBOEM7aUJBQ3hELEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO1lBQzVCLENBQUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUM7QUEzV0Qsb0JBMldDIiwiZmlsZSI6ImFwcC8rc2VhcmNoL3NlYXJjaC5jb21wb25lbnQuc3BlYy5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFNlYXJjaENvbXBvbmVudCB9IGZyb20gJy4vc2VhcmNoLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcy9PYnNlcnZhYmxlJztcbmltcG9ydCB7IE1vY2tBcHBTdG9yZSB9IGZyb20gJy4uL3N0b3JlL3NwZWMtaGVscGVycy9tb2NrLWFwcC5zdG9yZSc7XG5cbmV4cG9ydCBmdW5jdGlvbiBtYWluKCkge1xuICBkZXNjcmliZSgnU2VhcmNoIENvbXBvbmVudCcsICgpID0+IHtcbiAgICBsZXQgY29tcG9uZW50VW5kZXJUZXN0OiBTZWFyY2hDb21wb25lbnQ7XG4gICAgbGV0IG1vY2tTZWFyY2hTZXJ2aWNlOiBhbnk7XG4gICAgbGV0IG1vY2tVc2VyQ2FuOiBhbnk7XG4gICAgbGV0IG1vY2tTZWFyY2hDb250ZXh0OiBhbnk7XG4gICAgbGV0IG1vY2tGaWx0ZXI6IGFueTtcbiAgICBsZXQgbW9ja1VzZXJQcmVmZXJlbmNlczogYW55O1xuICAgIGxldCBtb2NrU29ydERlZmluaXRpb246IGFueTtcbiAgICBsZXQgbW9ja0NhcnQ6IGFueTtcbiAgICBsZXQgbW9ja0Fzc2V0U2VydmljZTogYW55O1xuICAgIGxldCBtb2NrUmVuZGVyZXI6IGFueTtcbiAgICBsZXQgbW9ja1dpbmRvdzogYW55O1xuICAgIGxldCBtb2NrUm91dGVyOiBhbnk7XG4gICAgbGV0IG1vY2tBY3RpdmF0ZWRSb3V0ZTogYW55O1xuICAgIGxldCBtb2NrUmVmRGV0ZWN0b3I6IGFueTtcbiAgICBsZXQgbW9ja1N0b3JlOiBNb2NrQXBwU3RvcmU7XG4gICAgbGV0IHNlYXJjaFJlc2V0RGlzcGF0Y2hTcHk6IGphc21pbmUuU3B5O1xuICAgIGxldCBjYW5FZGl0Q29sbGVjdGlvbjogYm9vbGVhbjtcbiAgICBsZXQgY29uZmlybWF0aW9uRGlhbG9nRGlzcGF0Y2hTcHk6IGphc21pbmUuU3B5O1xuXG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICBtb2NrVXNlckNhbiA9IHtcbiAgICAgICAgYWRtaW5pc3RlclF1b3RlczogKCkgPT4gZmFsc2UsXG4gICAgICAgIGVkaXRDb2xsZWN0aW9uOiAoKSA9PiBPYnNlcnZhYmxlLm9mKGNhbkVkaXRDb2xsZWN0aW9uKVxuICAgICAgfTtcblxuICAgICAgbW9ja1NlYXJjaENvbnRleHQgPSB7XG4gICAgICAgIHVwZGF0ZTogbnVsbCxcbiAgICAgICAgZ286IGphc21pbmUuY3JlYXRlU3B5KCdnbycpLFxuICAgICAgICByZW1vdmU6IGphc21pbmUuY3JlYXRlU3B5KCdyZW1vdmUnKSxcbiAgICAgICAgc3RhdGU6IHtcbiAgICAgICAgICBxOiAnY2F0JywgaTogNywgbjogMTAwLCBzb3J0SWQ6IDIzLCBmaWx0ZXJJZHM6ICcxNTE3JyxcbiAgICAgICAgICBmaWx0ZXJWYWx1ZXM6ICcxNTE3OjIwMTUtMTItMTAgLSAyMDE2LTEyLTEyJ1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICBtb2NrRmlsdGVyID0ge1xuICAgICAgICBsb2FkOiBqYXNtaW5lLmNyZWF0ZVNweSgnbG9hZCcpLmFuZC5yZXR1cm5WYWx1ZShPYnNlcnZhYmxlLm9mKFtdKSksXG4gICAgICAgIHNldDogamFzbWluZS5jcmVhdGVTcHkoJ3NldCcpLFxuICAgICAgICBhY3RpdmU6IGphc21pbmUuY3JlYXRlU3B5KCdhY3RpdmUnKSxcbiAgICAgICAgdG9nZ2xlOiBqYXNtaW5lLmNyZWF0ZVNweSgndG9nZ2xlJyksXG4gICAgICAgIGdldEFjdGl2ZTogamFzbWluZS5jcmVhdGVTcHkoJ2dldEFjdGl2ZScpLmFuZC5yZXR1cm5WYWx1ZShcbiAgICAgICAgICB7IGZpbHRlcnM6IFt7IGZpbHRlcklkOiAxIH0sIHsgZmlsdGVySWQ6IDIgfSwgeyBmaWx0ZXJJZDogMywgZmlsdGVyVmFsdWU6ICdDYXQnIH1dLCBpZHM6IFsxLCAyLCAzXSwgdmFsdWVzOiBbJ0NhdCddIH0pLFxuICAgICAgICBhZGRDdXN0b206IGphc21pbmUuY3JlYXRlU3B5KCdhZGRDdXN0b20nKSxcbiAgICAgICAgdG9nZ2xlRXhjbHVzaXZlOiBqYXNtaW5lLmNyZWF0ZVNweSgndG9nZ2xlRXhjbHVzaXZlJyksXG4gICAgICAgIGNsZWFyOiBqYXNtaW5lLmNyZWF0ZVNweSgnY2xlYXInKSxcbiAgICAgICAgdG9nZ2xlRmlsdGVyR3JvdXA6IGphc21pbmUuY3JlYXRlU3B5KCd0b2dnbGVGaWx0ZXJHcm91cCcpXG4gICAgICB9O1xuXG4gICAgICBtb2NrVXNlclByZWZlcmVuY2VzID0ge1xuICAgICAgICBkYXRhOiBPYnNlcnZhYmxlLm9mKHsgZGlzcGxheUZpbHRlckNvdW50czogZmFsc2UsIGRpc3BsYXlGaWx0ZXJUcmVlOiB0cnVlIH0pLFxuICAgICAgICB0b2dnbGVGaWx0ZXJDb3VudDogamFzbWluZS5jcmVhdGVTcHkoJ3RvZ2dsZUZpbHRlckNvdW50JyksXG4gICAgICAgIG9wZW5Db2xsZWN0aW9uVHJheTogamFzbWluZS5jcmVhdGVTcHkoJ29wZW5Db2xsZWN0aW9uVHJheScpLFxuICAgICAgICB1cGRhdGVTb3J0UHJlZmVyZW5jZTogamFzbWluZS5jcmVhdGVTcHkoJ3VwZGF0ZVNvcnRQcmVmZXJlbmNlJyksXG4gICAgICAgIHN0YXRlOiB7IGRpc3BsYXlGaWx0ZXJDb3VudHM6IGZhbHNlLCBkaXNwbGF5RmlsdGVyVHJlZTogdHJ1ZSB9LFxuICAgICAgICB1cGRhdGVBc3NldFZpZXdQcmVmZXJlbmNlOiBqYXNtaW5lLmNyZWF0ZVNweSgndXBkYXRlQXNzZXRWaWV3UHJlZmVyZW5jZScpXG4gICAgICB9O1xuXG4gICAgICBtb2NrU29ydERlZmluaXRpb24gPSB7XG4gICAgICAgIHVwZGF0ZVNvcnRQcmVmZXJlbmNlOiBqYXNtaW5lLmNyZWF0ZVNweSgndXBkYXRlU29ydFByZWZlcmVuY2UnKSxcbiAgICAgICAgdXBkYXRlOiBqYXNtaW5lLmNyZWF0ZVNweSgndXBkYXRlJyksXG4gICAgICAgIGRhdGE6IE9ic2VydmFibGUub2YoeyBjdXJyZW50U29ydDogJ21vY2tTb3J0JyB9KVxuICAgICAgfTtcblxuICAgICAgbW9ja0NhcnQgPSB7XG4gICAgICAgIGFkZEFzc2V0VG9Qcm9qZWN0SW5DYXJ0OiBqYXNtaW5lLmNyZWF0ZVNweSgnYWRkQXNzZXRUb1Byb2plY3RJbkNhcnQnKVxuICAgICAgfTtcblxuICAgICAgbW9ja1dpbmRvdyA9IHtcbiAgICAgICAgbmF0aXZlV2luZG93OiB7XG4gICAgICAgICAgbG9jYXRpb246IHsgaHJlZjogbnVsbCB9LFxuICAgICAgICAgIGlubmVyV2lkdGg6IDUwMFxuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgbW9ja0FjdGl2YXRlZFJvdXRlID0ge1xuICAgICAgICBzbmFwc2hvdDoge1xuICAgICAgICAgIHBhcmFtczoge1xuICAgICAgICAgICAgZ3E6ICdbe1wiaWRzXCI6WzEzLDE4XSxcIm5hbWVzXCI6W1wicHJlc3MgcGFja2V0XCIsXCJkYXkgMDRcIl19LHtcImlkc1wiOlszXSxcIm5hbWVzXCI6W1wiYWRhbSBzY290dFwiXX1dJyxcbiAgICAgICAgICAgIG46IDEsXG4gICAgICAgICAgICBpOiAxMDBcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIG1vY2tSb3V0ZXIgPSB7XG4gICAgICAgIG5hdmlnYXRlOiBqYXNtaW5lLmNyZWF0ZVNweSgnbmF2aWdhdGUnKSxcbiAgICAgICAgZXZlbnRzOiBPYnNlcnZhYmxlLm9mKHt9KVxuICAgICAgfTtcblxuICAgICAgbW9ja1JlZkRldGVjdG9yID0ge1xuICAgICAgICBtYXJrRm9yQ2hlY2s6ICgpID0+IHsgcmV0dXJuIHRydWU7IH1cbiAgICAgIH07XG5cbiAgICAgIG1vY2tTdG9yZSA9IG5ldyBNb2NrQXBwU3RvcmUoKTtcblxuICAgICAgc2VhcmNoUmVzZXREaXNwYXRjaFNweSA9IG1vY2tTdG9yZS5jcmVhdGVBY3Rpb25GYWN0b3J5TWV0aG9kKCdzZWFyY2gnLCAncmVzZXQnKTtcbiAgICAgIGNvbmZpcm1hdGlvbkRpYWxvZ0Rpc3BhdGNoU3B5ID0gbW9ja1N0b3JlLmNyZWF0ZUFjdGlvbkZhY3RvcnlNZXRob2QoJ2RpYWxvZycsICdzaG93Q29uZmlybWF0aW9uJyk7XG5cbiAgICAgIGNvbXBvbmVudFVuZGVyVGVzdCA9IG5ldyBTZWFyY2hDb21wb25lbnQoXG4gICAgICAgIG1vY2tVc2VyQ2FuLCBtb2NrRmlsdGVyLCBtb2NrQ2FydCwgbW9ja1NvcnREZWZpbml0aW9uLCBtb2NrU2VhcmNoQ29udGV4dCxcbiAgICAgICAgbW9ja1VzZXJQcmVmZXJlbmNlcywgbW9ja1dpbmRvdywgbW9ja0FjdGl2YXRlZFJvdXRlLCBtb2NrUm91dGVyLCBtb2NrUmVmRGV0ZWN0b3IsIG1vY2tTdG9yZVxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdjb25zdHJ1Y3RvcigpJywgKCkgPT4ge1xuICAgICAgaXQoJ3Nob3VsZCBub3Qgc2V0IHRoZSBwYXRoIGlmIHRoZSBcImdxXCIgcGFyYW1ldGVyIGRvZXNuXFwndCBleGlzdCcsICgpID0+IHtcbiAgICAgICAgbW9ja0FjdGl2YXRlZFJvdXRlID0geyBzbmFwc2hvdDogeyBwYXJhbXM6IHsgaTogMSwgbjogMTAwIH0gfSB9O1xuICAgICAgICBjb21wb25lbnRVbmRlclRlc3QgPSBuZXcgU2VhcmNoQ29tcG9uZW50KFxuICAgICAgICAgIG1vY2tVc2VyQ2FuLCBtb2NrRmlsdGVyLCBtb2NrQ2FydCwgbW9ja1NvcnREZWZpbml0aW9uLCBtb2NrU2VhcmNoQ29udGV4dCxcbiAgICAgICAgICBtb2NrVXNlclByZWZlcmVuY2VzLCBtb2NrV2luZG93LCBtb2NrQWN0aXZhdGVkUm91dGUsIG1vY2tSb3V0ZXIsIG1vY2tSZWZEZXRlY3RvciwgbW9ja1N0b3JlXG4gICAgICAgICk7XG5cbiAgICAgICAgZXhwZWN0KGNvbXBvbmVudFVuZGVyVGVzdC5wYXRoKS50b0VxdWFsKCcnKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnc2hvdWxkIHNldCB0aGUgcGF0aCBpZiB0aGVyZSBpcyBhIFwiZ3FcIiBwYXJhbWV0ZXInLCAoKSA9PiB7XG4gICAgICAgIGV4cGVjdChjb21wb25lbnRVbmRlclRlc3QucGF0aCkudG9FcXVhbChbXG4gICAgICAgICAgeyAnaWRzJzogWzEzLCAxOF0sICduYW1lcyc6IFsncHJlc3MgcGFja2V0JywgJ2RheSAwNCddIH0sXG4gICAgICAgICAgeyAnaWRzJzogWzNdLCAnbmFtZXMnOiBbJ2FkYW0gc2NvdHQnXSB9XG4gICAgICAgIF0pO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdyZXR1cm5zIG9ic2VydmFibGUgb2YgdHJ1ZSB3aGVuIHRoZSBcXCdmaWx0ZXJzQXJlQXZhaWxhYmxlXFwnaW4gdGhlIHN0b3JlIGlzIHRydWUnLCAoKSA9PiB7XG4gICAgICAgIG1vY2tTdG9yZS5jcmVhdGVTdGF0ZVNlY3Rpb24oJ2hlYWRlckRpc3BsYXlPcHRpb25zJywgeyBmaWx0ZXJzQXJlQXZhaWxhYmxlOiB0cnVlIH0pO1xuICAgICAgICBjb21wb25lbnRVbmRlclRlc3QgPSBuZXcgU2VhcmNoQ29tcG9uZW50KFxuICAgICAgICAgIG1vY2tVc2VyQ2FuLCBtb2NrRmlsdGVyLCBtb2NrQ2FydCwgbW9ja1NvcnREZWZpbml0aW9uLCBtb2NrU2VhcmNoQ29udGV4dCxcbiAgICAgICAgICBtb2NrVXNlclByZWZlcmVuY2VzLCBtb2NrV2luZG93LCBtb2NrQWN0aXZhdGVkUm91dGUsIG1vY2tSb3V0ZXIsIG1vY2tSZWZEZXRlY3RvciwgbW9ja1N0b3JlXG4gICAgICAgICk7XG4gICAgICAgIGxldCBhcmVBdmFpbGFibGU6IGJvb2xlYW47XG4gICAgICAgIGNvbXBvbmVudFVuZGVyVGVzdC5maWx0ZXJzQXJlQXZhaWxhYmxlLnRha2UoMSkuc3Vic2NyaWJlKGF2YWlsYWJsZSA9PiBhcmVBdmFpbGFibGUgPSBhdmFpbGFibGUpO1xuICAgICAgICBleHBlY3QoYXJlQXZhaWxhYmxlKS50b0JlKHRydWUpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnb25DTGlja0JyZWFkY3J1bWIoKScsICgpID0+IHtcbiAgICAgIGl0KCdzaG91bGQgYXBwZW5kIHRvIHRoZSBwYXRoIGFuZCBjYWxsIHJvdXRlci5uYXZpZ2F0ZSgpJywgKCkgPT4ge1xuICAgICAgICBjb21wb25lbnRVbmRlclRlc3QucGF0aCA9IFtcbiAgICAgICAgICB7ICdpZHMnOiBbMTMsIDE4XSwgJ25hbWVzJzogWydwcmVzcyBwYWNrZXQnLCAnZGF5IDA0J10gfSxcbiAgICAgICAgICB7ICdpZHMnOiBbM10sICduYW1lcyc6IFsnYWRhbSBzY290dCddIH1cbiAgICAgICAgXTtcbiAgICAgICAgY29tcG9uZW50VW5kZXJUZXN0Lm9uQ2xpY2tCcmVhZGNydW1iKDEpO1xuXG4gICAgICAgIGV4cGVjdChtb2NrUm91dGVyLm5hdmlnYXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChbXG4gICAgICAgICAgJy9nYWxsZXJ5LXZpZXcnLFxuICAgICAgICAgIHsgcGF0aDogJ1t7XCJpZHNcIjpbMTMsMThdLFwibmFtZXNcIjpbXCJwcmVzcyBwYWNrZXRcIixcImRheSAwNFwiXX1dJyB9XG4gICAgICAgIF0pO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnb25yZXNpemUoKScsICgpID0+IHtcbiAgICAgIGl0KCdTaG91bGQgc2V0IHRoZSBzY3JlZW4gc2l6ZSB2YXJpYWJsZSB3aGVuIHNjcmVlbiBzaXplIGNoYW5nZScsICgpID0+IHtcbiAgICAgICAgbW9ja1dpbmRvdy5uYXRpdmVXaW5kb3cub25yZXNpemUoKTtcbiAgICAgICAgZXhwZWN0KGNvbXBvbmVudFVuZGVyVGVzdC5zY3JlZW5XaWR0aCkudG9CZSg1MDApO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnbmdPbkRlc3Ryb3koKScsICgpID0+IHtcbiAgICAgIGl0KCdkaXNwYXRjaCB0aGUgc2VhcmNoIHJlc2V0IGFjdGlvbicsICgpID0+IHtcbiAgICAgICAgY29tcG9uZW50VW5kZXJUZXN0Lm5nT25EZXN0cm95KCk7XG4gICAgICAgIG1vY2tTdG9yZS5leHBlY3REaXNwYXRjaEZvcihzZWFyY2hSZXNldERpc3BhdGNoU3B5KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ2NvdW50VG9nZ2xlKCknLCAoKSA9PiB7XG4gICAgICBpdCgnU2hvdWxkIGNhbGwgdGhlIGZpbHRlciBzZXJ2aWNlIGdldCB3aXRoIHRoZSBzZWFyY2ggY29udGV4dCBzdGF0ZSBhbmQgdGhlIG9wcG9zaXRlIGJvb2xlYW4gdmFsdWUnICtcbiAgICAgICAgKycgb2YgdGhlIGN1cnJlbnQgZGlzcGxheUZpbHRlckNvdW50cyBib29sZWFuJywgKCkgPT4ge1xuICAgICAgICAgIGNvbXBvbmVudFVuZGVyVGVzdC5jb3VudFRvZ2dsZSgpO1xuICAgICAgICAgIGV4cGVjdChjb21wb25lbnRVbmRlclRlc3QuZmlsdGVyLmxvYWQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICAgICAgeyBxOiAnY2F0JywgaTogNywgbjogMTAwLCBzb3J0SWQ6IDIzLCBmaWx0ZXJJZHM6ICcxNTE3JywgZmlsdGVyVmFsdWVzOiAnMTUxNzoyMDE1LTEyLTEwIC0gMjAxNi0xMi0xMicgfSxcbiAgICAgICAgICAgIHRydWVcbiAgICAgICAgICApO1xuICAgICAgICB9KTtcblxuICAgICAgaXQoJ1Nob3VsZCBjYWxsIHRoZSB1c2VyIHByZWZlcmVuY2Ugc2VydmljZSB0byB0b2dnbGUgdGhlIGZpbHRlciBjb3VudCBib29sZWFuJywgKCkgPT4ge1xuICAgICAgICBjb21wb25lbnRVbmRlclRlc3QuY291bnRUb2dnbGUoKTtcbiAgICAgICAgZXhwZWN0KG1vY2tVc2VyUHJlZmVyZW5jZXMudG9nZ2xlRmlsdGVyQ291bnQpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ2NoYW5nZVBhZ2UoKScsICgpID0+IHtcbiAgICAgIGl0KCdTaG91bGQgY2FsbCB0aGUgdXBkYXRlIHNldHRlciBvbiBzZWFyY2ggY29udGV4dCB0byB1cGRhdGUgdGhlIHNlYXJjaCBjb250ZXh0IHN0YXRlJywgKCkgPT4ge1xuICAgICAgICBjb21wb25lbnRVbmRlclRlc3QuY2hhbmdlUGFnZSgxKTtcbiAgICAgICAgZXhwZWN0KG1vY2tTZWFyY2hDb250ZXh0LnVwZGF0ZSkudG9FcXVhbCh7IGk6IDEgfSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ1Nob3VsZCBjYWxsIHRoZSBnbyBtZXRob2Qgb24gc2VhcmNoQ29udGV4dCcsICgpID0+IHtcbiAgICAgICAgY29tcG9uZW50VW5kZXJUZXN0LmNoYW5nZVBhZ2UoMSk7XG4gICAgICAgIGV4cGVjdChtb2NrU2VhcmNoQ29udGV4dC5nbykudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnZmlsdGVyRXZlbnQoKScsICgpID0+IHtcbiAgICAgIGl0KCdTaG91bGQgY2FsbCB0aGUgZmlsdGVyIHNlcnZpY2Ugd2l0aCBhIGZpbHRlciBpZCB0byB0b2dnbGUgaXRzIGJvb2xlYW4gb24vb2ZmIHZhbHVlJywgKCkgPT4ge1xuICAgICAgICBjb21wb25lbnRVbmRlclRlc3QuZmlsdGVyRXZlbnQoeyBldmVudDogJ3RvZ2dsZUZpbHRlcicsIGZpbHRlcjogeyBmaWx0ZXJJZDogMSB9IH0pO1xuICAgICAgICBleHBlY3QoY29tcG9uZW50VW5kZXJUZXN0LmZpbHRlci50b2dnbGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKDEpO1xuICAgICAgICBleHBlY3QobW9ja1NlYXJjaENvbnRleHQuZ28pLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnU2hvdWxkIGNhbGwgdGhlIGZpbHRlciBzZXJ2aWNlIHRvIHRvZ2dsZSBhIGZpbHRlciBncm91cCB0byBzaG93L2hpZGUnLCAoKSA9PiB7XG4gICAgICAgIGNvbXBvbmVudFVuZGVyVGVzdC5maWx0ZXJFdmVudCh7IGV2ZW50OiAndG9nZ2xlRmlsdGVyR3JvdXAnLCBmaWx0ZXI6IHsgZmlsdGVySWQ6IDEgfSB9KTtcbiAgICAgICAgZXhwZWN0KGNvbXBvbmVudFVuZGVyVGVzdC5maWx0ZXIudG9nZ2xlRmlsdGVyR3JvdXApLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHsgZmlsdGVySWQ6IDEgfSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ1Nob3VsZCBjYWxsIHRoZSBmaWx0ZXIgc2VydmljZSB0byBhcHBseSBhbiBleGN1bHNpdmUgZmlsdGVyJywgKCkgPT4ge1xuICAgICAgICBjb21wb25lbnRVbmRlclRlc3QuZmlsdGVyRXZlbnQoeyBldmVudDogJ2FwcGx5RXhjbHVzaXZlRmlsdGVyJywgZmlsdGVyOiB7IGZpbHRlcklkOiAxIH0gfSk7XG4gICAgICAgIGV4cGVjdChjb21wb25lbnRVbmRlclRlc3QuZmlsdGVyLnRvZ2dsZUV4Y2x1c2l2ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoeyBmaWx0ZXJJZDogMSB9KTtcbiAgICAgICAgZXhwZWN0KG1vY2tTZWFyY2hDb250ZXh0LmdvKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ1Nob3VsZCBjYWxsIHRoZSBmaWx0ZXIgc2VydmljZSB0byBhcHBseSBhIGN1c3RvbSB2YWx1ZSBvbiBhIGZpbHRlcicsICgpID0+IHtcbiAgICAgICAgY29tcG9uZW50VW5kZXJUZXN0LmZpbHRlckV2ZW50KFxuICAgICAgICAgIHsgZXZlbnQ6ICdhcHBseUN1c3RvbVZhbHVlJywgZmlsdGVyOiB7IGZpbHRlcklkOiAxIH0sIGN1c3RvbVZhbHVlOiAnbW9ja0N1c3RvbVZhbHVlJyB9XG4gICAgICAgICk7XG4gICAgICAgIGV4cGVjdChjb21wb25lbnRVbmRlclRlc3QuZmlsdGVyLmFkZEN1c3RvbSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoeyBmaWx0ZXJJZDogMSB9LCAnbW9ja0N1c3RvbVZhbHVlJyk7XG4gICAgICAgIGV4cGVjdChtb2NrU2VhcmNoQ29udGV4dC5nbykudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdTaG91bGQgY2FsbCB0aGUgZmlsdGVyIHNlcnZpY2UgdG8gY2xlYXIgYWxsIGZpbHRlcnMgLyByZXNldCcsICgpID0+IHtcbiAgICAgICAgY29tcG9uZW50VW5kZXJUZXN0LmZpbHRlckV2ZW50KHsgZXZlbnQ6ICdjbGVhckZpbHRlcnMnLCBmaWx0ZXI6IHsgZmlsdGVySWQ6IDEgfSB9KTtcbiAgICAgICAgZXhwZWN0KGNvbXBvbmVudFVuZGVyVGVzdC5maWx0ZXIuY2xlYXIpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgICAgZXhwZWN0KG1vY2tTZWFyY2hDb250ZXh0LmdvKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdvblNvcnRSZXN1bHRzKCknLCAoKSA9PiB7XG4gICAgICBpdCgnU2hvdWxkIGNhbGwgdGhlIHVzZXIgcHJlZmVyZW5jZSBzZXJ2aWNlIHRvIHVwZGF0ZSB0aGUgdXNlciBzb3J0IHByZWZlcmVuY2UnLCAoKSA9PiB7XG4gICAgICAgIGNvbXBvbmVudFVuZGVyVGVzdC5zb3J0UmVzdWx0cyh7IGlkOiAnc29ydEJ5RGF0ZScgfSk7XG4gICAgICAgIGV4cGVjdChtb2NrVXNlclByZWZlcmVuY2VzLnVwZGF0ZVNvcnRQcmVmZXJlbmNlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnc29ydEJ5RGF0ZScpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdTaG91bGQgY2FsbCBzb3J0IGRlZmluaXRpb24gc2VydmljZSB0byB1cGRhdGUgd2l0aCBuZXcgc29ydCcsICgpID0+IHtcbiAgICAgICAgY29tcG9uZW50VW5kZXJUZXN0LnNvcnRSZXN1bHRzKHsgaWQ6ICdzb3J0QnlEYXRlJyB9KTtcbiAgICAgICAgZXhwZWN0KG1vY2tTb3J0RGVmaW5pdGlvbi51cGRhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHsgY3VycmVudFNvcnQ6IHsgaWQ6ICdzb3J0QnlEYXRlJyB9IH0pO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdTaG91bGQgY2FsbCB0aGUgc2VhcmNoIGNvbnRleHQgc2VydmljZSB0byB1cGRhdGUgdGhlIHN0b3JlIHdpdGggdGhlIG5ldyBzb3J0IHByZWZlcmVuY2UgZm9yIHRoZSB1cmwnLCAoKSA9PiB7XG4gICAgICAgIGNvbXBvbmVudFVuZGVyVGVzdC5zb3J0UmVzdWx0cyh7IGlkOiAnc29ydEJ5RGF0ZScgfSk7XG4gICAgICAgIGV4cGVjdChtb2NrU2VhcmNoQ29udGV4dC51cGRhdGUpLnRvRXF1YWwoeyAnaSc6IDEsICdzb3J0SWQnOiAnc29ydEJ5RGF0ZScgfSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ1Nob3VsZCBjYWxsIHRoZSBzZWFyY2ggY29udGV4dCBzZXJ2aWNlIHRvIGV4ZWN0dWUgYW5kIG5ldyBicm93c2VyIHVybCcsICgpID0+IHtcbiAgICAgICAgY29tcG9uZW50VW5kZXJUZXN0LnNvcnRSZXN1bHRzKHsgaWQ6ICdzb3J0QnlEYXRlJyB9KTtcbiAgICAgICAgZXhwZWN0KG1vY2tTZWFyY2hDb250ZXh0LmdvKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdjaGFuZ2VBc3NldFZpZXcoKScsICgpID0+IHtcbiAgICAgIGl0KCdTaG91bGQgdXBkYXRlIHVzZXIgcHJlZmVyZW5jZSB3aGVuIG5ldyB2aWV3IHR5cGUgaXMgc2VsZWN0ZWQnLCAoKSA9PiB7XG4gICAgICAgIGNvbXBvbmVudFVuZGVyVGVzdC5jaGFuZ2VBc3NldFZpZXcoJ2xpc3QnKTtcbiAgICAgICAgZXhwZWN0KG1vY2tVc2VyUHJlZmVyZW5jZXMudXBkYXRlQXNzZXRWaWV3UHJlZmVyZW5jZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ2xpc3QnKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ2FkZEFzc2V0VG9DYXJ0KCknLCAoKSA9PiB7XG4gICAgICBpdCgnU2hvdWxkIGNhbGwgdGhlIGNhcnQgc3VtbWFyeSBzZXJ2aWNlIHRvIGFkZCBhbiBhc3NldCB0byB0aGUgY2FydCcsICgpID0+IHtcbiAgICAgICAgY29tcG9uZW50VW5kZXJUZXN0LmFkZEFzc2V0VG9DYXJ0KHsgYXNzZXRJZDogJ21vY2tJZCcgfSk7XG4gICAgICAgIGV4cGVjdChtb2NrQ2FydC5hZGRBc3NldFRvUHJvamVjdEluQ2FydCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoeyBsaW5lSXRlbTogeyBhc3NldDogeyBhc3NldElkOiAnbW9ja0lkJyB9IH0gfSk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdmaWx0ZXJBc3NldHMoKScsICgpID0+IHtcbiAgICAgIGl0KCdTaG91bGQgcmVzZXQgdGhlIHBhZ2UgbnVtYmVyIHRvIHBhZ2UgMScsICgpID0+IHtcbiAgICAgICAgbW9ja0ZpbHRlci5nZXRBY3RpdmUgPSBqYXNtaW5lLmNyZWF0ZVNweSgnZ2V0QWN0aXZlJykuYW5kLnJldHVyblZhbHVlKHsgZmlsdGVyczogW10sIGlkczogW10sIHZhbHVlczogW10gfSk7XG4gICAgICAgIGNvbXBvbmVudFVuZGVyVGVzdCA9IG5ldyBTZWFyY2hDb21wb25lbnQoXG4gICAgICAgICAgbW9ja1VzZXJDYW4sIG1vY2tGaWx0ZXIsIG1vY2tDYXJ0LCBtb2NrU29ydERlZmluaXRpb24sIG1vY2tTZWFyY2hDb250ZXh0LFxuICAgICAgICAgIG1vY2tVc2VyUHJlZmVyZW5jZXMsIG1vY2tXaW5kb3csIG1vY2tBY3RpdmF0ZWRSb3V0ZSwgbW9ja1JvdXRlciwgbW9ja1JlZkRldGVjdG9yLFxuICAgICAgICAgIG1vY2tTdG9yZVxuICAgICAgICApO1xuICAgICAgICBjb21wb25lbnRVbmRlclRlc3QuZmlsdGVyRXZlbnQoeyBldmVudDogJ2NsZWFyRmlsdGVycycsIGZpbHRlcjogeyBmaWx0ZXJJZDogMSB9IH0pO1xuICAgICAgICBleHBlY3QobW9ja1NlYXJjaENvbnRleHQudXBkYXRlKS50b0VxdWFsKHsgaTogMSB9KTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnU2hvdWxkIHVwZGF0ZSB0aGUgc2VhcmNoIGNvbnRleHQgd2l0aCB0aGUgZmlsdGVyIGlkcycsICgpID0+IHtcbiAgICAgICAgbW9ja0ZpbHRlci5nZXRBY3RpdmUgPSBqYXNtaW5lLmNyZWF0ZVNweSgnZ2V0QWN0aXZlJykuYW5kLnJldHVyblZhbHVlKHsgZmlsdGVyczogW10sIGlkczogWzEsIDIsIDNdLCB2YWx1ZXM6IFtdIH0pO1xuICAgICAgICBjb21wb25lbnRVbmRlclRlc3QgPSBuZXcgU2VhcmNoQ29tcG9uZW50KFxuICAgICAgICAgIG1vY2tVc2VyQ2FuLCBtb2NrRmlsdGVyLCBtb2NrQ2FydCwgbW9ja1NvcnREZWZpbml0aW9uLCBtb2NrU2VhcmNoQ29udGV4dCxcbiAgICAgICAgICBtb2NrVXNlclByZWZlcmVuY2VzLCBtb2NrV2luZG93LCBtb2NrQWN0aXZhdGVkUm91dGUsIG1vY2tSb3V0ZXIsIG1vY2tSZWZEZXRlY3RvcixcbiAgICAgICAgICBtb2NrU3RvcmVcbiAgICAgICAgKTtcbiAgICAgICAgY29tcG9uZW50VW5kZXJUZXN0LmZpbHRlckV2ZW50KHsgZXZlbnQ6ICdjbGVhckZpbHRlcnMnLCBmaWx0ZXI6IHsgZmlsdGVySWQ6IDEgfSB9KTtcbiAgICAgICAgZXhwZWN0KG1vY2tTZWFyY2hDb250ZXh0LnVwZGF0ZSkudG9FcXVhbCh7ICdmaWx0ZXJJZHMnOiAnMSwyLDMnIH0pO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdTaG91bGQgcmVtb3ZlIHRoZSBmaWx0ZXJJZHMgZnJvbSB0aGUgc2VhcmNoIGNvbnRleHQnLCAoKSA9PiB7XG4gICAgICAgIG1vY2tGaWx0ZXIuZ2V0QWN0aXZlID0gamFzbWluZS5jcmVhdGVTcHkoJ2dldEFjdGl2ZScpLmFuZC5yZXR1cm5WYWx1ZSh7IGZpbHRlcnM6IFtdLCBpZHM6IFtdLCB2YWx1ZXM6IFsnY2F0JywgJ2RvZyddIH0pO1xuICAgICAgICBjb21wb25lbnRVbmRlclRlc3QgPSBuZXcgU2VhcmNoQ29tcG9uZW50KFxuICAgICAgICAgIG1vY2tVc2VyQ2FuLCBtb2NrRmlsdGVyLCBtb2NrQ2FydCwgbW9ja1NvcnREZWZpbml0aW9uLCBtb2NrU2VhcmNoQ29udGV4dCxcbiAgICAgICAgICBtb2NrVXNlclByZWZlcmVuY2VzLCBtb2NrV2luZG93LCBtb2NrQWN0aXZhdGVkUm91dGUsIG1vY2tSb3V0ZXIsIG1vY2tSZWZEZXRlY3RvcixcbiAgICAgICAgICBtb2NrU3RvcmVcbiAgICAgICAgKTtcbiAgICAgICAgY29tcG9uZW50VW5kZXJUZXN0LmZpbHRlckV2ZW50KHsgZXZlbnQ6ICdjbGVhckZpbHRlcnMnLCBmaWx0ZXI6IHsgZmlsdGVySWQ6IDEgfSB9KTtcbiAgICAgICAgZXhwZWN0KG1vY2tTZWFyY2hDb250ZXh0LnJlbW92ZSkudG9FcXVhbCgnZmlsdGVySWRzJyk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ1Nob3VsZCB1cGRhdGUgdGhlIHNlYXJjaCBjb250ZXh0IHdpdGggdGhlIGZpbHRlciB2YWx1ZXMnLCAoKSA9PiB7XG4gICAgICAgIG1vY2tGaWx0ZXIuZ2V0QWN0aXZlID0gamFzbWluZS5jcmVhdGVTcHkoJ2dldEFjdGl2ZScpLmFuZC5yZXR1cm5WYWx1ZSh7IGZpbHRlcnM6IFtdLCBpZHM6IFtdLCB2YWx1ZXM6IFsnY2F0JywgJ2RvZyddIH0pO1xuICAgICAgICBjb21wb25lbnRVbmRlclRlc3QgPSBuZXcgU2VhcmNoQ29tcG9uZW50KFxuICAgICAgICAgIG1vY2tVc2VyQ2FuLCBtb2NrRmlsdGVyLCBtb2NrQ2FydCwgbW9ja1NvcnREZWZpbml0aW9uLCBtb2NrU2VhcmNoQ29udGV4dCxcbiAgICAgICAgICBtb2NrVXNlclByZWZlcmVuY2VzLCBtb2NrV2luZG93LCBtb2NrQWN0aXZhdGVkUm91dGUsIG1vY2tSb3V0ZXIsIG1vY2tSZWZEZXRlY3RvcixcbiAgICAgICAgICBtb2NrU3RvcmVcbiAgICAgICAgKTtcbiAgICAgICAgY29tcG9uZW50VW5kZXJUZXN0LmZpbHRlckV2ZW50KHsgZXZlbnQ6ICdjbGVhckZpbHRlcnMnLCBmaWx0ZXI6IHsgZmlsdGVySWQ6IDEgfSB9KTtcbiAgICAgICAgZXhwZWN0KG1vY2tTZWFyY2hDb250ZXh0LnVwZGF0ZSkudG9FcXVhbCh7ICdmaWx0ZXJWYWx1ZXMnOiAnY2F0LGRvZycgfSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ1Nob3VsZCByZW1vdmUgdGhlIGZpbHRlclZhbHVlcyBmcm9tIHRoZSBzZWFyY2ggY29udGV4dCcsICgpID0+IHtcbiAgICAgICAgbW9ja0ZpbHRlci5nZXRBY3RpdmUgPSBqYXNtaW5lLmNyZWF0ZVNweSgnZ2V0QWN0aXZlJykuYW5kLnJldHVyblZhbHVlKHsgZmlsdGVyczogW10sIGlkczogW10sIHZhbHVlczogW10gfSk7XG4gICAgICAgIGNvbXBvbmVudFVuZGVyVGVzdCA9IG5ldyBTZWFyY2hDb21wb25lbnQoXG4gICAgICAgICAgbW9ja1VzZXJDYW4sIG1vY2tGaWx0ZXIsIG1vY2tDYXJ0LCBtb2NrU29ydERlZmluaXRpb24sIG1vY2tTZWFyY2hDb250ZXh0LFxuICAgICAgICAgIG1vY2tVc2VyUHJlZmVyZW5jZXMsIG1vY2tXaW5kb3csIG1vY2tBY3RpdmF0ZWRSb3V0ZSwgbW9ja1JvdXRlciwgbW9ja1JlZkRldGVjdG9yLFxuICAgICAgICAgIG1vY2tTdG9yZVxuICAgICAgICApO1xuICAgICAgICBjb21wb25lbnRVbmRlclRlc3QuZmlsdGVyRXZlbnQoeyBldmVudDogJ2NsZWFyRmlsdGVycycsIGZpbHRlcjogeyBmaWx0ZXJJZDogMSB9IH0pO1xuICAgICAgICBleHBlY3QobW9ja1NlYXJjaENvbnRleHQucmVtb3ZlKS50b0VxdWFsKCdmaWx0ZXJWYWx1ZXMnKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnU2hvdWxkIGNhbGwgZ28gb24gc2VhcmNoIGNvbnRleHQgd2hlbiBpdCBoYXMgZmlsdGVyZWQgdGhlIGFzc2V0cycsICgpID0+IHtcbiAgICAgICAgbW9ja0ZpbHRlci5nZXRBY3RpdmUgPSBqYXNtaW5lLmNyZWF0ZVNweSgnZ2V0QWN0aXZlJykuYW5kLnJldHVyblZhbHVlKHsgZmlsdGVyczogW10sIGlkczogW10sIHZhbHVlczogW10gfSk7XG4gICAgICAgIGNvbXBvbmVudFVuZGVyVGVzdCA9IG5ldyBTZWFyY2hDb21wb25lbnQoXG4gICAgICAgICAgbW9ja1VzZXJDYW4sIG1vY2tGaWx0ZXIsIG1vY2tDYXJ0LCBtb2NrU29ydERlZmluaXRpb24sIG1vY2tTZWFyY2hDb250ZXh0LFxuICAgICAgICAgIG1vY2tVc2VyUHJlZmVyZW5jZXMsIG1vY2tXaW5kb3csIG1vY2tBY3RpdmF0ZWRSb3V0ZSwgbW9ja1JvdXRlciwgbW9ja1JlZkRldGVjdG9yLFxuICAgICAgICAgIG1vY2tTdG9yZVxuICAgICAgICApO1xuICAgICAgICBjb21wb25lbnRVbmRlclRlc3QuZmlsdGVyRXZlbnQoeyBldmVudDogJ2NsZWFyRmlsdGVycycsIGZpbHRlcjogeyBmaWx0ZXJJZDogMSB9IH0pO1xuICAgICAgICBleHBlY3QobW9ja1NlYXJjaENvbnRleHQuZ28pLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ2NhbkVkaXRDb2xsZWN0aW9uKCknLCAoKSA9PiB7XG4gICAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgICAgbW9ja1N0b3JlLmNyZWF0ZVN0YXRlU2VjdGlvbignYWN0aXZlQ29sbGVjdGlvbicsIHsgY29sbGVjdGlvbjogeyBzb21lOiAnY29sbGVjdGlvbicgfSB9KTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgncmV0dXJucyB0cnVlIGlmIHVzZXJDYW4uZWRpdENvbGxlY3Rpb24oKSByZXR1cm5zIHRydWUnLCAoKSA9PiB7XG4gICAgICAgIGNhbkVkaXRDb2xsZWN0aW9uID0gdHJ1ZTtcbiAgICAgICAgbGV0IHJlc3VsdDogYm9vbGVhbjtcbiAgICAgICAgY29tcG9uZW50VW5kZXJUZXN0LmNhbkVkaXRDb2xsZWN0aW9uLnRha2UoMSkuc3Vic2NyaWJlKHJlcyA9PiByZXN1bHQgPSByZXMpO1xuICAgICAgICBleHBlY3QocmVzdWx0KS50b0JlKHRydWUpO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdyZXR1cm5zIGZhbHNlIGlmIHVzZXJDYW4uZWRpdENvbGxlY3Rpb24oKSByZXR1cm5zIGZhbHNlJywgKCkgPT4ge1xuICAgICAgICBjYW5FZGl0Q29sbGVjdGlvbiA9IGZhbHNlO1xuICAgICAgICBsZXQgcmVzdWx0OiBib29sZWFuO1xuICAgICAgICBjb21wb25lbnRVbmRlclRlc3QuY2FuRWRpdENvbGxlY3Rpb24udGFrZSgxKS5zdWJzY3JpYmUocmVzID0+IHJlc3VsdCA9IHJlcyk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUoZmFsc2UpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnb25DbGlja0FkZEFsbEJ0bigpJywgKCkgPT4ge1xuICAgICAgaXQoJ2Rpc3BhdGNoZXMgdGhlIHByb3BlciBhY3Rpb24nLCAoKSA9PiB7XG4gICAgICAgIG1vY2tTdG9yZS5jcmVhdGVTdGF0ZVNlY3Rpb24oJ2FjdGl2ZUNvbGxlY3Rpb24nLCB7IGNvbGxlY3Rpb246IHsgbmFtZTogJ3NvbWUgY29sbGVjdGlvbicgfSB9KTtcbiAgICAgICAgY29tcG9uZW50VW5kZXJUZXN0Lm9uQ2xpY2tBZGRBbGxCdG4oKTtcblxuICAgICAgICBtb2NrU3RvcmUuZXhwZWN0RGlzcGF0Y2hGb3IoY29uZmlybWF0aW9uRGlhbG9nRGlzcGF0Y2hTcHksIHtcbiAgICAgICAgICB0aXRsZTogeyBrZXk6ICdTRUFSQ0guQUREX0FMTF9UT19DT0xMRUNUSU9OLkNPTkZJUk0uVElUTEUnLCB2YWx1ZXM6IHsgY29sbGVjdGlvbk5hbWU6ICdzb21lIGNvbGxlY3Rpb24nIH0gfSxcbiAgICAgICAgICBtZXNzYWdlOiB7IGtleTogJ1NFQVJDSC5BRERfQUxMX1RPX0NPTExFQ1RJT04uQ09ORklSTS5NRVNTQUdFJywgdmFsdWVzOiB7IGNvbGxlY3Rpb25OYW1lOiAnc29tZSBjb2xsZWN0aW9uJyB9IH0sXG4gICAgICAgICAgYWNjZXB0OiAnU0VBUkNILkFERF9BTExfVE9fQ09MTEVDVElPTi5DT05GSVJNLkFDQ0VQVCcsXG4gICAgICAgICAgZGVjbGluZTogJ1NFQVJDSC5BRERfQUxMX1RPX0NPTExFQ1RJT04uQ09ORklSTS5ERUNMSU5FJ1xuICAgICAgICB9LCBqYXNtaW5lLmFueShGdW5jdGlvbikpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xufVxuXG4iXX0=
