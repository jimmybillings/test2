"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var cart_service_1 = require("./cart.service");
var mock_api_service_1 = require("../spec-helpers/mock-api.service");
var api_interface_1 = require("../../shared/interfaces/api.interface");
var index_1 = require("../../shared/modules/wazee-frame-formatter/index");
function main() {
    describe('Future Cart Service', function () {
        var serviceUnderTest, mockApiService;
        beforeEach(function () {
            jasmine.addMatchers(mock_api_service_1.mockApiMatchers);
            mockApiService = new mock_api_service_1.MockApiService();
            serviceUnderTest = new cart_service_1.FutureCartService(mockApiService.injector);
        });
        describe('load()', function () {
            it('calls the api service correctly', function () {
                serviceUnderTest.load();
                expect(mockApiService.get).toHaveBeenCalledWithApi(api_interface_1.Api.Orders);
                expect(mockApiService.get).toHaveBeenCalledWithEndpoint('cart');
                expect(mockApiService.get).toHaveBeenCalledWithLoading();
            });
        });
        describe('editLineItem()', function () {
            describe('calls the api service correctly', function () {
                it('when called with markers and attributes', function () {
                    serviceUnderTest.editLineItem({ id: 3, asset: { some: 'asset' } }, { in: new index_1.Frame(30).setFromFrameNumber(30), out: new index_1.Frame(30).setFromFrameNumber(60) }, [{ priceAttributeName: 'some', selectedAttributeValue: 'attribute' }]);
                    expect(mockApiService.put).toHaveBeenCalledWithApi(api_interface_1.Api.Orders);
                    expect(mockApiService.put).toHaveBeenCalledWithEndpoint('cart/update/lineItem/3');
                    expect(mockApiService.put).toHaveBeenCalledWithLoading(true);
                    expect(mockApiService.put).toHaveBeenCalledWithBody({
                        id: 3,
                        asset: { some: 'asset', timeStart: 1000, timeEnd: 2000 },
                        attributes: [
                            { priceAttributeName: 'some', selectedAttributeValue: 'attribute' }
                        ]
                    });
                    expect(mockApiService.put).toHaveBeenCalledWithParameters({ region: 'AAA' });
                });
                it('when just called with attributes', function () {
                    serviceUnderTest.editLineItem({ id: 3, asset: { some: 'asset', timeStart: 333, timeEnd: 999 } }, null, [{ priceAttributeName: 'some', selectedAttributeValue: 'attribute' }]);
                    expect(mockApiService.put).toHaveBeenCalledWithApi(api_interface_1.Api.Orders);
                    expect(mockApiService.put).toHaveBeenCalledWithEndpoint('cart/update/lineItem/3');
                    expect(mockApiService.put).toHaveBeenCalledWithLoading(true);
                    expect(mockApiService.put).toHaveBeenCalledWithBody({
                        id: 3,
                        asset: { some: 'asset', timeStart: 333, timeEnd: 999 },
                        attributes: [
                            { priceAttributeName: 'some', selectedAttributeValue: 'attribute' }
                        ]
                    });
                    expect(mockApiService.put).toHaveBeenCalledWithParameters({ region: 'AAA' });
                });
                it('when just called with markers', function () {
                    serviceUnderTest.editLineItem({
                        id: 3,
                        asset: { some: 'asset' }
                    }, { in: new index_1.Frame(30).setFromFrameNumber(30), out: new index_1.Frame(30).setFromFrameNumber(60) }, null);
                    expect(mockApiService.put).toHaveBeenCalledWithApi(api_interface_1.Api.Orders);
                    expect(mockApiService.put).toHaveBeenCalledWithEndpoint('cart/update/lineItem/3');
                    expect(mockApiService.put).toHaveBeenCalledWithLoading(true);
                    expect(mockApiService.put).toHaveBeenCalledWithBody({
                        id: 3,
                        asset: { some: 'asset', timeStart: 1000, timeEnd: 2000 },
                        attributes: []
                    });
                    expect(mockApiService.put).toHaveBeenCalledWithParameters({ region: 'AAA' });
                });
            });
        });
        describe('removeAsset()', function () {
            it('calls the API correctly', function () {
                serviceUnderTest.removeAsset({ uuid: 'ABCD' });
                expect(mockApiService.delete).toHaveBeenCalledWithApi(api_interface_1.Api.Orders);
                expect(mockApiService.delete).toHaveBeenCalledWithEndpoint('cart/asset/ABCD');
                expect(mockApiService.delete).toHaveBeenCalledWithLoading(true);
            });
        });
        describe('addNote()', function () {
            it('replaces the first note if the field already exists', function () {
                serviceUnderTest.addNote('some note', { id: 'abc-123', notes: [{ notes: ['note'] }] });
                expect(mockApiService.put).toHaveBeenCalledWithApi(api_interface_1.Api.Orders);
                expect(mockApiService.put).toHaveBeenCalledWithEndpoint('cart/update/lineItem/abc-123');
                expect(mockApiService.put).toHaveBeenCalledWithBody({ id: 'abc-123', notes: [{ notes: ['some note'] }] });
                expect(mockApiService.put).toHaveBeenCalledWithLoading(true);
            });
            it('adds the \'notes\' if the field doesn\'t exists', function () {
                serviceUnderTest.addNote('some note', { id: 'abc-123' });
                expect(mockApiService.put).toHaveBeenCalledWithApi(api_interface_1.Api.Orders);
                expect(mockApiService.put).toHaveBeenCalledWithEndpoint('cart/update/lineItem/abc-123');
                expect(mockApiService.put).toHaveBeenCalledWithBody({ id: 'abc-123', notes: [{ notes: ['some note'] }] });
                expect(mockApiService.put).toHaveBeenCalledWithLoading(true);
            });
        });
        describe('removeNoteFrom()', function () {
            it('calls the apiService correctly', function () {
                serviceUnderTest.removeNoteFrom({ id: 'abc-123', some: 'lineItem', notes: [{ notes: ['some note'] }] });
                expect(mockApiService.put).toHaveBeenCalledWithApi(api_interface_1.Api.Orders);
                expect(mockApiService.put).toHaveBeenCalledWithEndpoint('cart/update/lineItem/abc-123');
                expect(mockApiService.put).toHaveBeenCalledWithBody({ id: 'abc-123', some: 'lineItem' });
                expect(mockApiService.put).toHaveBeenCalledWithLoading(true);
            });
        });
    });
}
exports.main = main;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9zdG9yZS9jYXJ0L2NhcnQuc2VydmljZS5zcGVjLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsK0NBQW1EO0FBQ25ELHFFQUFtRjtBQUNuRix1RUFBNEQ7QUFDNUQsMEVBQXlFO0FBRXpFO0lBQ0UsUUFBUSxDQUFDLHFCQUFxQixFQUFFO1FBQzlCLElBQUksZ0JBQW1DLEVBQUUsY0FBOEIsQ0FBQztRQUV4RSxVQUFVLENBQUM7WUFDVCxPQUFPLENBQUMsV0FBVyxDQUFDLGtDQUFlLENBQUMsQ0FBQztZQUNyQyxjQUFjLEdBQUcsSUFBSSxpQ0FBYyxFQUFFLENBQUM7WUFDdEMsZ0JBQWdCLEdBQUcsSUFBSSxnQ0FBaUIsQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDcEUsQ0FBQyxDQUFDLENBQUM7UUFFSCxRQUFRLENBQUMsUUFBUSxFQUFFO1lBQ2pCLEVBQUUsQ0FBQyxpQ0FBaUMsRUFBRTtnQkFDcEMsZ0JBQWdCLENBQUMsSUFBSSxFQUFFLENBQUM7Z0JBRXhCLE1BQU0sQ0FBQyxjQUFjLENBQUMsR0FBRyxDQUFDLENBQUMsdUJBQXVCLENBQUMsbUJBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQztnQkFDL0QsTUFBTSxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsQ0FBQyw0QkFBNEIsQ0FBQyxNQUFNLENBQUMsQ0FBQztnQkFDaEUsTUFBTSxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsQ0FBQywyQkFBMkIsRUFBRSxDQUFDO1lBQzNELENBQUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7UUFFSCxRQUFRLENBQUMsZ0JBQWdCLEVBQUU7WUFDekIsUUFBUSxDQUFDLGlDQUFpQyxFQUFFO2dCQUMxQyxFQUFFLENBQUMseUNBQXlDLEVBQUU7b0JBQzVDLGdCQUFnQixDQUFDLFlBQVksQ0FDM0IsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLEtBQUssRUFBRSxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsRUFBUyxFQUMx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QUNMLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDO0FBOUhELG9CQThIQyIsImZpbGUiOiJhcHAvc3RvcmUvY2FydC9jYXJ0LnNlcnZpY2Uuc3BlYy5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEZ1dHVyZUNhcnRTZXJ2aWNlIH0gZnJvbSAnLi9jYXJ0LnNlcnZpY2UnO1xuaW1wb3J0IHsgTW9ja0FwaVNlcnZpY2UsIG1vY2tBcGlNYXRjaGVycyB9IGZyb20gJy4uL3NwZWMtaGVscGVycy9tb2NrLWFwaS5zZXJ2aWNlJztcbmltcG9ydCB7IEFwaSB9IGZyb20gJy4uLy4uL3NoYXJlZC9pbnRlcmZhY2VzL2FwaS5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgRnJhbWUgfSBmcm9tICcuLi8uLi9zaGFyZWQvbW9kdWxlcy93YXplZS1mcmFtZS1mb3JtYXR0ZXIvaW5kZXgnO1xuXG5leHBvcnQgZnVuY3Rpb24gbWFpbigpIHtcbiAgZGVzY3JpYmUoJ0Z1dHVyZSBDYXJ0IFNlcnZpY2UnLCAoKSA9PiB7XG4gICAgbGV0IHNlcnZpY2VVbmRlclRlc3Q6IEZ1dHVyZUNhcnRTZXJ2aWNlLCBtb2NrQXBpU2VydmljZTogTW9ja0FwaVNlcnZpY2U7XG5cbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIGphc21pbmUuYWRkTWF0Y2hlcnMobW9ja0FwaU1hdGNoZXJzKTtcbiAgICAgIG1vY2tBcGlTZXJ2aWNlID0gbmV3IE1vY2tBcGlTZXJ2aWNlKCk7XG4gICAgICBzZXJ2aWNlVW5kZXJUZXN0ID0gbmV3IEZ1dHVyZUNhcnRTZXJ2aWNlKG1vY2tBcGlTZXJ2aWNlLmluamVjdG9yKTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdsb2FkKCknLCAoKSA9PiB7XG4gICAgICBpdCgnY2FsbHMgdGhlIGFwaSBzZXJ2aWNlIGNvcnJlY3RseScsICgpID0+IHtcbiAgICAgICAgc2VydmljZVVuZGVyVGVzdC5sb2FkKCk7XG5cbiAgICAgICAgZXhwZWN0KG1vY2tBcGlTZXJ2aWNlLmdldCkudG9IYXZlQmVlbkNhbGxlZFdpdGhBcGkoQXBpLk9yZGVycyk7XG4gICAgICAgIGV4cGVjdChtb2NrQXBpU2VydmljZS5nZXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoRW5kcG9pbnQoJ2NhcnQnKTtcbiAgICAgICAgZXhwZWN0KG1vY2tBcGlTZXJ2aWNlLmdldCkudG9IYXZlQmVlbkNhbGxlZFdpdGhMb2FkaW5nKCk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdlZGl0TGluZUl0ZW0oKScsICgpID0+IHtcbiAgICAgIGRlc2NyaWJlKCdjYWxscyB0aGUgYXBpIHNlcnZpY2UgY29ycmVjdGx5JywgKCkgPT4ge1xuICAgICAgICBpdCgnd2hlbiBjYWxsZWQgd2l0aCBtYXJrZXJzIGFuZCBhdHRyaWJ1dGVzJywgKCkgPT4ge1xuICAgICAgICAgIHNlcnZpY2VVbmRlclRlc3QuZWRpdExpbmVJdGVtKFxuICAgICAgICAgICAgeyBpZDogMywgYXNzZXQ6IHsgc29tZTogJ2Fzc2V0JyB9IH0gYXMgYW55LFxuICAgICAgICAgICAgeyBpbjogbmV3IEZyYW1lKDMwKS5zZXRGcm9tRnJhbWVOdW1iZXIoMzApLCBvdXQ6IG5ldyBGcmFtZSgzMCkuc2V0RnJvbUZyYW1lTnVtYmVyKDYwKSB9LFxuICAgICAgICAgICAgW3sgcHJpY2VBdHRyaWJ1dGVOYW1lOiAnc29tZScsIHNlbGVjdGVkQXR0cmlidXRlVmFsdWU6ICdhdHRyaWJ1dGUnIH0gYXMgYW55XVxuICAgICAgICAgICk7XG5cbiAgICAgICAgICBleHBlY3QobW9ja0FwaVNlcnZpY2UucHV0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aEFwaShBcGkuT3JkZXJzKTtcbiAgICAgICAgICBleHBlY3QobW9ja0FwaVNlcnZpY2UucHV0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aEVuZHBvaW50KCdjYXJ0L3VwZGF0ZS9saW5lSXRlbS8zJyk7XG4gICAgICAgICAgZXhwZWN0KG1vY2tBcGlTZXJ2aWNlLnB1dCkudG9IYXZlQmVlbkNhbGxlZFdpdGhMb2FkaW5nKHRydWUpO1xuICAgICAgICAgIGV4cGVjdChtb2NrQXBpU2VydmljZS5wdXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoQm9keSh7XG4gICAgICAgICAgICBpZDogMyxcbiAgICAgICAgICAgIGFzc2V0OiB7IHNvbWU6ICdhc3NldCcsIHRpbWVTdGFydDogMTAwMCwgdGltZUVuZDogMjAwMCB9LFxuICAgICAgICAgICAgYXR0cmlidXRlczogW1xuICAgICAgICAgICAgICB7IHByaWNlQXR0cmlidXRlTmFtZTogJ3NvbWUnLCBzZWxlY3RlZEF0dHJpYnV0ZVZhbHVlOiAnYXR0cmlidXRlJyB9XG4gICAgICAgICAgICBdXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgZXhwZWN0KG1vY2tBcGlTZXJ2aWNlLnB1dCkudG9IYXZlQmVlbkNhbGxlZFdpdGhQYXJhbWV0ZXJzKHsgcmVnaW9uOiAnQUFBJyB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ3doZW4ganVzdCBjYWxsZWQgd2l0aCBhdHRyaWJ1dGVzJywgKCkgPT4ge1xuICAgICAgICAgIHNlcnZpY2VVbmRlclRlc3QuZWRpdExpbmVJdGVtKFxuICAgICAgICAgICAgeyBpZDogMywgYXNzZXQ6IHsgc29tZTogJ2Fzc2V0JywgdGltZVN0YXJ0OiAzMzMsIHRpbWVFbmQ6IDk5OSB9IH0gYXMgYW55LFxuICAgICAgICAgICAgbnVsbCxcbiAgICAgICAgICAgIFt7IHByaWNlQXR0cmlidXRlTmFtZTogJ3NvbWUnLCBzZWxlY3RlZEF0dHJpYnV0ZVZhbHVlOiAnYXR0cmlidXRlJyB9IGFzIGFueV1cbiAgICAgICAgICApO1xuXG4gICAgICAgICAgZXhwZWN0KG1vY2tBcGlTZXJ2aWNlLnB1dCkudG9IYXZlQmVlbkNhbGxlZFdpdGhBcGkoQXBpLk9yZGVycyk7XG4gICAgICAgICAgZXhwZWN0KG1vY2tBcGlTZXJ2aWNlLnB1dCkudG9IYXZlQmVlbkNhbGxlZFdpdGhFbmRwb2ludCgnY2FydC91cGRhdGUvbGluZUl0ZW0vMycpO1xuICAgICAgICAgIGV4cGVjdChtb2NrQXBpU2VydmljZS5wdXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoTG9hZGluZyh0cnVlKTtcbiAgICAgICAgICBleHBlY3QobW9ja0FwaVNlcnZpY2UucHV0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aEJvZHkoe1xuICAgICAgICAgICAgaWQ6IDMsXG4gICAgICAgICAgICBhc3NldDogeyBzb21lOiAnYXNzZXQnLCB0aW1lU3RhcnQ6IDMzMywgdGltZUVuZDogOTk5IH0sXG4gICAgICAgICAgICBhdHRyaWJ1dGVzOiBbXG4gICAgICAgICAgICAgIHsgcHJpY2VBdHRyaWJ1dGVOYW1lOiAnc29tZScsIHNlbGVjdGVkQXR0cmlidXRlVmFsdWU6ICdhdHRyaWJ1dGUnIH1cbiAgICAgICAgICAgIF1cbiAgICAgICAgICB9KTtcbiAgICAgICAgICBleHBlY3QobW9ja0FwaVNlcnZpY2UucHV0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aFBhcmFtZXRlcnMoeyByZWdpb246ICdBQUEnIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnd2hlbiBqdXN0IGNhbGxlZCB3aXRoIG1hcmtlcnMnLCAoKSA9PiB7XG4gICAgICAgICAgc2VydmljZVVuZGVyVGVzdC5lZGl0TGluZUl0ZW0oXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIGlkOiAzLFxuICAgICAgICAgICAgICBhc3NldDogeyBzb21lOiAnYXNzZXQnIH1cbiAgICAgICAgICAgIH0gYXMgYW55LFxuICAgICAgICAgICAgeyBpbjogbmV3IEZyYW1lKDMwKS5zZXRGcm9tRnJhbWVOdW1iZXIoMzApLCBvdXQ6IG5ldyBGcmFtZSgzMCkuc2V0RnJvbUZyYW1lTnVtYmVyKDYwKSB9LFxuICAgICAgICAgICAgbnVsbFxuICAgICAgICAgICk7XG5cbiAgICAgICAgICBleHBlY3QobW9ja0FwaVNlcnZpY2UucHV0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aEFwaShBcGkuT3JkZXJzKTtcbiAgICAgICAgICBleHBlY3QobW9ja0FwaVNlcnZpY2UucHV0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aEVuZHBvaW50KCdjYXJ0L3VwZGF0ZS9saW5lSXRlbS8zJyk7XG4gICAgICAgICAgZXhwZWN0KG1vY2tBcGlTZXJ2aWNlLnB1dCkudG9IYXZlQmVlbkNhbGxlZFdpdGhMb2FkaW5nKHRydWUpO1xuICAgICAgICAgIGV4cGVjdChtb2NrQXBpU2VydmljZS5wdXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoQm9keSh7XG4gICAgICAgICAgICBpZDogMyxcbiAgICAgICAgICAgIGFzc2V0OiB7IHNvbWU6ICdhc3NldCcsIHRpbWVTdGFydDogMTAwMCwgdGltZUVuZDogMjAwMCB9LFxuICAgICAgICAgICAgYXR0cmlidXRlczogW11cbiAgICAgICAgICB9KTtcbiAgICAgICAgICBleHBlY3QobW9ja0FwaVNlcnZpY2UucHV0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aFBhcmFtZXRlcnMoeyByZWdpb246ICdBQUEnIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ3JlbW92ZUFzc2V0KCknLCAoKSA9PiB7XG4gICAgICBpdCgnY2FsbHMgdGhlIEFQSSBjb3JyZWN0bHknLCAoKSA9PiB7XG4gICAgICAgIHNlcnZpY2VVbmRlclRlc3QucmVtb3ZlQXNzZXQoeyB1dWlkOiAnQUJDRCcgfSk7XG5cbiAgICAgICAgZXhwZWN0KG1vY2tBcGlTZXJ2aWNlLmRlbGV0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGhBcGkoQXBpLk9yZGVycyk7XG4gICAgICAgIGV4cGVjdChtb2NrQXBpU2VydmljZS5kZWxldGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoRW5kcG9pbnQoJ2NhcnQvYXNzZXQvQUJDRCcpO1xuICAgICAgICBleHBlY3QobW9ja0FwaVNlcnZpY2UuZGVsZXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aExvYWRpbmcodHJ1ZSk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdhZGROb3RlKCknLCAoKSA9PiB7XG4gICAgICBpdCgncmVwbGFjZXMgdGhlIGZpcnN0IG5vdGUgaWYgdGhlIGZpZWxkIGFscmVhZHkgZXhpc3RzJywgKCkgPT4ge1xuICAgICAgICBzZXJ2aWNlVW5kZXJUZXN0LmFkZE5vdGUoJ3NvbWUgbm90ZScsIHsgaWQ6ICdhYmMtMTIzJywgbm90ZXM6IFt7IG5vdGVzOiBbJ25vdGUnXSB9XSB9KTtcblxuICAgICAgICBleHBlY3QobW9ja0FwaVNlcnZpY2UucHV0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aEFwaShBcGkuT3JkZXJzKTtcbiAgICAgICAgZXhwZWN0KG1vY2tBcGlTZXJ2aWNlLnB1dCkudG9IYXZlQmVlbkNhbGxlZFdpdGhFbmRwb2ludCgnY2FydC91cGRhdGUvbGluZUl0ZW0vYWJjLTEyMycpO1xuICAgICAgICBleHBlY3QobW9ja0FwaVNlcnZpY2UucHV0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aEJvZHkoeyBpZDogJ2FiYy0xMjMnLCBub3RlczogW3sgbm90ZXM6IFsnc29tZSBub3RlJ10gfV0gfSk7XG4gICAgICAgIGV4cGVjdChtb2NrQXBpU2VydmljZS5wdXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoTG9hZGluZyh0cnVlKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnYWRkcyB0aGUgXFwnbm90ZXNcXCcgaWYgdGhlIGZpZWxkIGRvZXNuXFwndCBleGlzdHMnLCAoKSA9PiB7XG4gICAgICAgIHNlcnZpY2VVbmRlclRlc3QuYWRkTm90ZSgnc29tZSBub3RlJywgeyBpZDogJ2FiYy0xMjMnIH0pO1xuXG4gICAgICAgIGV4cGVjdChtb2NrQXBpU2VydmljZS5wdXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoQXBpKEFwaS5PcmRlcnMpO1xuICAgICAgICBleHBlY3QobW9ja0FwaVNlcnZpY2UucHV0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aEVuZHBvaW50KCdjYXJ0L3VwZGF0ZS9saW5lSXRlbS9hYmMtMTIzJyk7XG4gICAgICAgIGV4cGVjdChtb2NrQXBpU2VydmljZS5wdXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoQm9keSh7IGlkOiAnYWJjLTEyMycsIG5vdGVzOiBbeyBub3RlczogWydzb21lIG5vdGUnXSB9XSB9KTtcbiAgICAgICAgZXhwZWN0KG1vY2tBcGlTZXJ2aWNlLnB1dCkudG9IYXZlQmVlbkNhbGxlZFdpdGhMb2FkaW5nKHRydWUpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgncmVtb3ZlTm90ZUZyb20oKScsICgpID0+IHtcbiAgICAgIGl0KCdjYWxscyB0aGUgYXBpU2VydmljZSBjb3JyZWN0bHknLCAoKSA9PiB7XG4gICAgICAgIHNlcnZpY2VVbmRlclRlc3QucmVtb3ZlTm90ZUZyb20oeyBpZDogJ2FiYy0xMjMnLCBzb21lOiAnbGluZUl0ZW0nLCBub3RlczogW3sgbm90ZXM6IFsnc29tZSBub3RlJ10gfV0gfSBhcyBhbnkpO1xuXG4gICAgICAgIGV4cGVjdChtb2NrQXBpU2VydmljZS5wdXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoQXBpKEFwaS5PcmRlcnMpO1xuICAgICAgICBleHBlY3QobW9ja0FwaVNlcnZpY2UucHV0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aEVuZHBvaW50KCdjYXJ0L3VwZGF0ZS9saW5lSXRlbS9hYmMtMTIzJyk7XG4gICAgICAgIGV4cGVjdChtb2NrQXBpU2VydmljZS5wdXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoQm9keSh7IGlkOiAnYWJjLTEyMycsIHNvbWU6ICdsaW5lSXRlbScgfSk7XG4gICAgICAgIGV4cGVjdChtb2NrQXBpU2VydmljZS5wdXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoTG9hZGluZyh0cnVlKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcbn1cbiJdfQ==
