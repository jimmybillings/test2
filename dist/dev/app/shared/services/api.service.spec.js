"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var http_1 = require("@angular/http");
var Observable_1 = require("rxjs/Observable");
var api_service_1 = require("./api.service");
var api_interface_1 = require("../interfaces/api.interface");
var ErrorActions = require("../../store/error/error.actions");
var LoadingIndicatorActions = require("../../store/loading-indicator/loading-indicator.actions");
function main() {
    describe('Api Service', function () {
        var serviceUnderTest;
        var mockHttp;
        var mockApiConfig;
        var mockNgrxStore;
        var loadingShowSpy;
        var loadingHideSpy;
        var successResponse = new http_1.Response({ status: 200, body: '{ "some": "data" }' });
        var error = { status: 401 };
        var errorAction = new ErrorActions.Handle(error);
        beforeEach(function () {
            mockHttp = {
                request: jasmine.createSpy('request').and.returnValue(Observable_1.Observable.of(successResponse))
            };
            mockApiConfig = {
                headers: function (token) {
                    if (token === void 0) { token = ''; }
                    return new http_1.Headers({ 'Authorization': token === '' ? 'STANDARD TOKEN' : token });
                },
                baseUrl: 'BASE/',
                portal: 'PORTAL'
            };
            mockNgrxStore = {
                dispatch: jasmine.createSpy('dispatch')
            };
            serviceUnderTest = new api_service_1.ApiService(mockHttp, mockApiConfig, mockNgrxStore);
        });
        ['get', 'post', 'put', 'delete'].forEach(function (methodName) {
            describe(methodName + "()", function () {
                var methodUnderTest;
                var expectedHttpMethod;
                var getMethodInfoFrom = function (methodName) {
                    switch (methodName) {
                        case 'get': return [serviceUnderTest.get, http_1.RequestMethod.Get];
                        case 'post': return [serviceUnderTest.post, http_1.RequestMethod.Post];
                        case 'put': return [serviceUnderTest.put, http_1.RequestMethod.Put];
                        case 'delete': return [serviceUnderTest.delete, http_1.RequestMethod.Delete];
                        default: return [undefined, undefined];
                    }
                };
                var mostRecentRequest = function () { return mockHttp.request.calls.mostRecent().args[0]; };
                beforeEach(function () {
                    _a = getMethodInfoFrom(methodName), methodUnderTest = _a[0], expectedHttpMethod = _a[1];
                    var _a;
                });
                it('uses the correct HTTP method', function () {
                    methodUnderTest.call(serviceUnderTest, api_interface_1.Api.Identities, 'end/point');
                    expect(mostRecentRequest().method).toEqual(expectedHttpMethod);
                });
                describe('URL', function () {
                    it('is correct for all backend APIs', function () {
                        methodUnderTest.call(serviceUnderTest, api_interface_1.Api.Identities, 'end/point');
                        expect(mostRecentRequest().url).toEqual('BASE/identities-api/v1/end/point?siteName=PORTAL');
                        methodUnderTest.call(serviceUnderTest, api_interface_1.Api.Assets, 'end/point');
                        expect(mostRecentRequest().url).toEqual('BASE/assets-api/v1/end/point?siteName=PORTAL');
                        methodUnderTest.call(serviceUnderTest, api_interface_1.Api.Orders, 'end/point');
                        expect(mostRecentRequest().url).toEqual('BASE/orders-api/v1/end/point?siteName=PORTAL');
                    });
                    it('is unusable when an undefined backend API is specified', function () {
                        methodUnderTest.call(serviceUnderTest, 10836, 'end/point');
                        expect(mostRecentRequest().url).toEqual('BASE/?-api/v?/end/point&siteName=PORTAL');
                    });
                    it('is correct with no options', function () {
                        methodUnderTest.call(serviceUnderTest, api_interface_1.Api.Identities, 'end/point');
                        expect(mostRecentRequest().url).toEqual('BASE/identities-api/v1/end/point?siteName=PORTAL');
                    });
                    it('is correct with parameters', function () {
                        methodUnderTest.call(serviceUnderTest, api_interface_1.Api.Identities, 'end/point', { parameters: { a: 'b', c: 'd' } });
                        expect(mostRecentRequest().url).toEqual('BASE/identities-api/v1/end/point?a=b&c=d&siteName=PORTAL');
                    });
                    it('disregards a passed-in siteName parameter', function () {
                        spyOn(console, 'error');
                        methodUnderTest.call(serviceUnderTest, api_interface_1.Api.Identities, 'end/point', { parameters: { a: 'b', c: 'd', siteName: 'TEST' } });
                        expect(mostRecentRequest().url).toEqual('BASE/identities-api/v1/end/point?a=b&c=d&siteName=PORTAL');
                    });
                    it('properly encodes a \'+\' to a \' \'', function () {
                        methodUnderTest.call(serviceUnderTest, api_interface_1.Api.Identities, 'end/point', { parameters: { a: 'b+c' } });
                        expect(mostRecentRequest().url).toEqual('BASE/identities-api/v1/end/point?a=b%2Bc&siteName=PORTAL');
                    });
                });
                describe('headers', function () {
                    it('is correct with no options', function () {
                        methodUnderTest.call(serviceUnderTest, api_interface_1.Api.Identities, 'end/point');
                        expect(mostRecentRequest().headers.get('Authorization')).toEqual('STANDARD TOKEN');
                    });
                    it('is correct with override token', function () {
                        methodUnderTest.call(serviceUnderTest, api_interface_1.Api.Identities, 'end/point', { overridingToken: 'OVERRIDING TOKEN' });
                        expect(mostRecentRequest().headers.get('Authorization')).toEqual('OVERRIDING TOKEN');
                    });
                });
                describe('body', function () {
                    it('is just the site name when no body option is specified', function () {
                        methodUnderTest.call(serviceUnderTest, api_interface_1.Api.Identities, 'end/point');
                        expect(mostRecentRequest()._body).toEqual('{"siteName":"PORTAL"}');
                    });
                    it('is the specified body plus the site name - for an object', function () {
                        methodUnderTest.call(serviceUnderTest, api_interface_1.Api.Identities, 'end/point', { body: { a: 'b' } });
                        expect(mostRecentRequest()._body).toEqual('{"a":"b","siteName":"PORTAL"}');
                    });
                    it('is the specified body plus the site name - for an array', function () {
                        methodUnderTest.call(serviceUnderTest, api_interface_1.Api.Identities, 'end/point', { body: [1, 2, 3] });
                        expect(mostRecentRequest()._body).toEqual('[1,2,3]');
                    });
                });
                describe('result', function () {
                    var mockHandlers;
                    beforeEach(function () {
                        mockHandlers = jasmine.createSpyObj('mockHandlers', ['response', 'error']);
                    });
                    it('is as expected when the request succeeds', function () {
                        var apiResponse;
                        methodUnderTest.call(serviceUnderTest, api_interface_1.Api.Identities, 'end/point').subscribe(function (response) {
                            apiResponse = response;
                            mockHandlers.response();
                        }, mockHandlers.error);
                        expect(apiResponse).toEqual({ some: 'data' });
                        expect(mockHandlers.response).toHaveBeenCalled();
                        expect(mockHandlers.error).not.toHaveBeenCalled();
                        expect(mockNgrxStore.dispatch).not.toHaveBeenCalled();
                    });
                    it('is as expected when the request succeeds with a non-JSON response', function () {
                        var apiResponse;
                        mockHttp.request = jasmine.createSpy('request').and.returnValue(Observable_1.Observable.of('Non-JSON!  Ick!'));
                        methodUnderTest.call(serviceUnderTest, api_interface_1.Api.Identities, 'end/point').subscribe(function (response) {
                            apiResponse = response;
                            mockHandlers.response();
                        }, mockHandlers.error);
                        expect(apiResponse).toEqual('Non-JSON!  Ick!');
                        expect(mockHandlers.response).toHaveBeenCalled();
                        expect(mockHandlers.error).not.toHaveBeenCalled();
                        expect(mockNgrxStore.dispatch).not.toHaveBeenCalled();
                    });
                    it('is as expected when the request errors', function () {
                        var apiError;
                        mockHttp.request = jasmine.createSpy('request').and.returnValue(Observable_1.Observable.throw(error));
                        methodUnderTest.call(serviceUnderTest, api_interface_1.Api.Identities, 'end/point').subscribe(mockHandlers.response, function (error) {
                            apiError = error;
                            mockHandlers.error();
                        });
                        expect(apiError).toEqual({ status: 401 });
                        expect(mockHandlers.response).not.toHaveBeenCalled();
                        expect(mockHandlers.error).toHaveBeenCalled();
                        expect(mockNgrxStore.dispatch.calls.allArgs()).toEqual([[errorAction]]);
                    });
                });
                describe('loading indicator animation', function () {
                    var showAction = new LoadingIndicatorActions.Show();
                    var hideAction = new LoadingIndicatorActions.Hide();
                    var nonErrorActionDispatches = function () {
                        return mockNgrxStore.dispatch.calls.allArgs().filter(function (arg) { return arg[0].type !== '[Error] Handle'; });
                    };
                    ['succeeds', 'errors'].forEach(function (result) {
                        describe("when the request " + result, function () {
                            beforeEach(function () {
                                mockHttp.request = jasmine.createSpy('request').and.returnValue(result === 'succeeds' ? Observable_1.Observable.of(successResponse) : Observable_1.Observable.throw(error));
                            });
                            describe('when loadingIndicator option is not specified', function () {
                                it('is not affected', function () {
                                    methodUnderTest.call(serviceUnderTest, api_interface_1.Api.Identities, 'end/point')
                                        .subscribe(function () { }, function () { });
                                    expect(mockNgrxStore.dispatch.calls.allArgs().filter(function (arg) { return arg[0].type !== '[Error] Handle'; })).toEqual([]);
                                });
                            });
                            describe('when loadingIndicator option is false', function () {
                                it('is not affected', function () {
                                    methodUnderTest.call(serviceUnderTest, api_interface_1.Api.Identities, 'end/point', { loadingIndicator: false })
                                        .subscribe(function () { }, function () { });
                                    expect(nonErrorActionDispatches()).toEqual([]);
                                });
                            });
                            describe('when loadingIndicator option is true', function () {
                                it('is started with the request and stopped when the response is returned', function () {
                                    methodUnderTest.call(serviceUnderTest, api_interface_1.Api.Identities, 'end/point', { loadingIndicator: true })
                                        .subscribe(function () { }, function () { });
                                    expect(nonErrorActionDispatches()).toEqual([[showAction], [hideAction]]);
                                });
                            });
                            describe('when loadingIndicator option is onBeforeRequest', function () {
                                it('is only started with the request and not turned off when the response is returned', function () {
                                    methodUnderTest.call(serviceUnderTest, api_interface_1.Api.Identities, 'end/point', { loadingIndicator: 'onBeforeRequest' })
                                        .subscribe(function () { }, function () { });
                                    expect(nonErrorActionDispatches()).toEqual([[showAction]]);
                                });
                            });
                            describe('when loadingIndicator option is offAfterResponse', function () {
                                it('is not started with the request but is stopped when the response is returned', function () {
                                    methodUnderTest.call(serviceUnderTest, api_interface_1.Api.Identities, 'end/point', { loadingIndicator: 'offAfterResponse' })
                                        .subscribe(function () { }, function () { });
                                    expect(nonErrorActionDispatches()).toEqual([[hideAction]]);
                                });
                            });
                        });
                    });
                });
            });
        });
    });
}
exports.main = main;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9zaGFyZWQvc2VydmljZXMvYXBpLnNlcnZpY2Uuc3BlYy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLHNDQUErSDtBQUMvSCw4Q0FBNkM7QUFLN0MsNkNBQTJDO0FBQzNDLDZEQUErRDtBQUcvRCw4REFBZ0U7QUFDaEUsaUdBQW1HO0FBRW5HO0lBQ0UsUUFBUSxDQUFDLGFBQWEsRUFBRTtRQUN0QixJQUFJLGdCQUE0QixDQUFDO1FBQ2pDLElBQUksUUFBYSxDQUFDO1FBQ2xCLElBQUksYUFBa0IsQ0FBQztRQUN2QixJQUFJLGFBQWtCLENBQUM7UUFDdkIsSUFBSSxjQUEyQixDQUFDO1FBQ2hDLElBQUksY0FBMkIsQ0FBQztRQUVoQyxJQUFNLGVBQWUsR0FBYSxJQUFJLGVBQVEsQ0FBQyxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLG9CQUFvQixFQUFxQixDQUFDLENBQUM7UUFDL0csSUFBTSxLQUFLLEdBQVEsRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLENBQUM7UUFDbkMsSUFBTSxXQUFXLEdBQXdCLElBQUksWUFBWSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUV4RSxVQUFVLENBQUM7WUFDVCxRQUFRLEdBQUc7Z0JBQ1QsT0FBTyxFQUFFLE9BQU8sQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyx1QkFBVSxDQUFDLEVBQUUsQ0FBQyxlQUFlLENBQUMsQ0FBQzthQUN0RixDQUFDO1lBRUYsYUFBYSxHQUFHO2dCQUNkLE9BQU8sRUFBRSxVQUFDLEtBQWtCO29CQUFsQixzQkFBQSxFQUFBLFVBQWtCO29CQUFLLE9BQUEsSUFBSSxjQUFPLENBQUMsRUFBRSxlQUFlLEVBQUUsS0FBSyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUFDO2dCQUF6RSxDQUF5RTtnQkFDMUcsT0FBTyxFQUFFLE9BQU87Z0JB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L3NoYXJlZC9zZXJ2aWNlcy9hcGkuc2VydmljZS5zcGVjLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSGVhZGVycywgUmVzcG9uc2UsIEJhc2VSZXF1ZXN0T3B0aW9ucywgUmVxdWVzdE1ldGhvZCwgSHR0cCwgUmVzcG9uc2VPcHRpb25zLCBDb25uZWN0aW9uQmFja2VuZCB9IGZyb20gJ0Bhbmd1bGFyL2h0dHAnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMvT2JzZXJ2YWJsZSc7XG5pbXBvcnQgeyBpbmplY3QsIFRlc3RCZWQgfSBmcm9tICdAYW5ndWxhci9jb3JlL3Rlc3RpbmcnO1xuaW1wb3J0IHsgTW9ja0JhY2tlbmQgfSBmcm9tICdAYW5ndWxhci9odHRwL3Rlc3RpbmcnO1xuaW1wb3J0IHsgU3RvcmUgfSBmcm9tICdAbmdyeC9zdG9yZSc7XG5cbmltcG9ydCB7IEFwaVNlcnZpY2UgfSBmcm9tICcuL2FwaS5zZXJ2aWNlJztcbmltcG9ydCB7IEFwaSwgQXBpUmVzcG9uc2UgfSBmcm9tICcuLi9pbnRlcmZhY2VzL2FwaS5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgQXBpQ29uZmlnIH0gZnJvbSAnLi9hcGkuY29uZmlnJztcbmltcG9ydCB7IEFwcFN0b3JlIH0gZnJvbSAnLi4vLi4vYXBwLnN0b3JlJztcbmltcG9ydCAqIGFzIEVycm9yQWN0aW9ucyBmcm9tICcuLi8uLi9zdG9yZS9lcnJvci9lcnJvci5hY3Rpb25zJztcbmltcG9ydCAqIGFzIExvYWRpbmdJbmRpY2F0b3JBY3Rpb25zIGZyb20gJy4uLy4uL3N0b3JlL2xvYWRpbmctaW5kaWNhdG9yL2xvYWRpbmctaW5kaWNhdG9yLmFjdGlvbnMnO1xuXG5leHBvcnQgZnVuY3Rpb24gbWFpbigpIHtcbiAgZGVzY3JpYmUoJ0FwaSBTZXJ2aWNlJywgKCkgPT4ge1xuICAgIGxldCBzZXJ2aWNlVW5kZXJUZXN0OiBBcGlTZXJ2aWNlO1xuICAgIGxldCBtb2NrSHR0cDogYW55O1xuICAgIGxldCBtb2NrQXBpQ29uZmlnOiBhbnk7XG4gICAgbGV0IG1vY2tOZ3J4U3RvcmU6IGFueTtcbiAgICBsZXQgbG9hZGluZ1Nob3dTcHk6IGphc21pbmUuU3B5O1xuICAgIGxldCBsb2FkaW5nSGlkZVNweTogamFzbWluZS5TcHk7XG5cbiAgICBjb25zdCBzdWNjZXNzUmVzcG9uc2U6IFJlc3BvbnNlID0gbmV3IFJlc3BvbnNlKHsgc3RhdHVzOiAyMDAsIGJvZHk6ICd7IFwic29tZVwiOiBcImRhdGFcIiB9JyB9IGFzIFJlc3BvbnNlT3B0aW9ucyk7XG4gICAgY29uc3QgZXJyb3I6IGFueSA9IHsgc3RhdHVzOiA0MDEgfTtcbiAgICBjb25zdCBlcnJvckFjdGlvbjogRXJyb3JBY3Rpb25zLkhhbmRsZSA9IG5ldyBFcnJvckFjdGlvbnMuSGFuZGxlKGVycm9yKTtcblxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgbW9ja0h0dHAgPSB7XG4gICAgICAgIHJlcXVlc3Q6IGphc21pbmUuY3JlYXRlU3B5KCdyZXF1ZXN0JykuYW5kLnJldHVyblZhbHVlKE9ic2VydmFibGUub2Yoc3VjY2Vzc1Jlc3BvbnNlKSlcbiAgICAgIH07XG5cbiAgICAgIG1vY2tBcGlDb25maWcgPSB7XG4gICAgICAgIGhlYWRlcnM6ICh0b2tlbjogc3RyaW5nID0gJycpID0+IG5ldyBIZWFkZXJzKHsgJ0F1dGhvcml6YXRpb24nOiB0b2tlbiA9PT0gJycgPyAnU1RBTkRBUkQgVE9LRU4nIDogdG9rZW4gfSksXG4gICAgICAgIGJhc2VVcmw6ICdCQVNFLycsXG4gICAgICAgIHBvcnRhbDogJ1BPUlRBTCdcbiAgICAgIH07XG5cbiAgICAgIG1vY2tOZ3J4U3RvcmUgPSB7XG4gICAgICAgIGRpc3BhdGNoOiBqYXNtaW5lLmNyZWF0ZVNweSgnZGlzcGF0Y2gnKVxuICAgICAgfTtcblxuICAgICAgc2VydmljZVVuZGVyVGVzdCA9IG5ldyBBcGlTZXJ2aWNlKG1vY2tIdHRwLCBtb2NrQXBpQ29uZmlnLCBtb2NrTmdyeFN0b3JlKTtcbiAgICB9KTtcblxuICAgIFsnZ2V0JywgJ3Bvc3QnLCAncHV0JywgJ2RlbGV0ZSddLmZvckVhY2gobWV0aG9kTmFtZSA9PiB7XG4gICAgICBkZXNjcmliZShgJHttZXRob2ROYW1lfSgpYCwgKCkgPT4ge1xuICAgICAgICBsZXQgbWV0aG9kVW5kZXJUZXN0OiBGdW5jdGlvbjtcbiAgICAgICAgbGV0IGV4cGVjdGVkSHR0cE1ldGhvZDogUmVxdWVzdE1ldGhvZDtcblxuICAgICAgICBjb25zdCBnZXRNZXRob2RJbmZvRnJvbTogRnVuY3Rpb24gPSAobWV0aG9kTmFtZTogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgc3dpdGNoIChtZXRob2ROYW1lKSB7XG4gICAgICAgICAgICBjYXNlICdnZXQnOiByZXR1cm4gW3NlcnZpY2VVbmRlclRlc3QuZ2V0LCBSZXF1ZXN0TWV0aG9kLkdldF07XG4gICAgICAgICAgICBjYXNlICdwb3N0JzogcmV0dXJuIFtzZXJ2aWNlVW5kZXJUZXN0LnBvc3QsIFJlcXVlc3RNZXRob2QuUG9zdF07XG4gICAgICAgICAgICBjYXNlICdwdXQnOiByZXR1cm4gW3NlcnZpY2VVbmRlclRlc3QucHV0LCBSZXF1ZXN0TWV0aG9kLlB1dF07XG4gICAgICAgICAgICBjYXNlICdkZWxldGUnOiByZXR1cm4gW3NlcnZpY2VVbmRlclRlc3QuZGVsZXRlLCBSZXF1ZXN0TWV0aG9kLkRlbGV0ZV07XG4gICAgICAgICAgICBkZWZhdWx0OiByZXR1cm4gW3VuZGVmaW5lZCwgdW5kZWZpbmVkXTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgbW9zdFJlY2VudFJlcXVlc3Q6IEZ1bmN0aW9uID0gKCkgPT4gbW9ja0h0dHAucmVxdWVzdC5jYWxscy5tb3N0UmVjZW50KCkuYXJnc1swXTtcblxuICAgICAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgICAgICBbbWV0aG9kVW5kZXJUZXN0LCBleHBlY3RlZEh0dHBNZXRob2RdID0gZ2V0TWV0aG9kSW5mb0Zyb20obWV0aG9kTmFtZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCd1c2VzIHRoZSBjb3JyZWN0IEhUVFAgbWV0aG9kJywgKCkgPT4ge1xuICAgICAgICAgIG1ldGhvZFVuZGVyVGVzdC5jYWxsKHNlcnZpY2VVbmRlclRlc3QsIEFwaS5JZGVudGl0aWVzLCAnZW5kL3BvaW50Jyk7XG5cbiAgICAgICAgICBleHBlY3QobW9zdFJlY2VudFJlcXVlc3QoKS5tZXRob2QpLnRvRXF1YWwoZXhwZWN0ZWRIdHRwTWV0aG9kKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZGVzY3JpYmUoJ1VSTCcsICgpID0+IHtcbiAgICAgICAgICBpdCgnaXMgY29ycmVjdCBmb3IgYWxsIGJhY2tlbmQgQVBJcycsICgpID0+IHtcbiAgICAgICAgICAgIG1ldGhvZFVuZGVyVGVzdC5jYWxsKHNlcnZpY2VVbmRlclRlc3QsIEFwaS5JZGVudGl0aWVzLCAnZW5kL3BvaW50Jyk7XG4gICAgICAgICAgICBleHBlY3QobW9zdFJlY2VudFJlcXVlc3QoKS51cmwpLnRvRXF1YWwoJ0JBU0UvaWRlbnRpdGllcy1hcGkvdjEvZW5kL3BvaW50P3NpdGVOYW1lPVBPUlRBTCcpO1xuXG4gICAgICAgICAgICBtZXRob2RVbmRlclRlc3QuY2FsbChzZXJ2aWNlVW5kZXJUZXN0LCBBcGkuQXNzZXRzLCAnZW5kL3BvaW50Jyk7XG4gICAgICAgICAgICBleHBlY3QobW9zdFJlY2VudFJlcXVlc3QoKS51cmwpLnRvRXF1YWwoJ0JBU0UvYXNzZXRzLWFwaS92MS9lbmQvcG9pbnQ/c2l0ZU5hbWU9UE9SVEFMJyk7XG5cbiAgICAgICAgICAgIG1ldGhvZFVuZGVyVGVzdC5jYWxsKHNlcnZpY2VVbmRlclRlc3QsIEFwaS5PcmRlcnMsICdlbmQvcG9pbnQnKTtcbiAgICAgICAgICAgIGV4cGVjdChtb3N0UmVjZW50UmVxdWVzdCgpLnVybCkudG9FcXVhbCgnQkFTRS9vcmRlcnMtYXBpL3YxL2VuZC9wb2ludD9zaXRlTmFtZT1QT1JUQUwnKTtcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIGl0KCdpcyB1bnVzYWJsZSB3aGVuIGFuIHVuZGVmaW5lZCBiYWNrZW5kIEFQSSBpcyBzcGVjaWZpZWQnLCAoKSA9PiB7XG4gICAgICAgICAgICBtZXRob2RVbmRlclRlc3QuY2FsbChzZXJ2aWNlVW5kZXJUZXN0LCAxMDgzNiBhcyBBcGksICdlbmQvcG9pbnQnKTtcblxuICAgICAgICAgICAgZXhwZWN0KG1vc3RSZWNlbnRSZXF1ZXN0KCkudXJsKS50b0VxdWFsKCdCQVNFLz8tYXBpL3Y/L2VuZC9wb2ludCZzaXRlTmFtZT1QT1JUQUwnKTtcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIGl0KCdpcyBjb3JyZWN0IHdpdGggbm8gb3B0aW9ucycsICgpID0+IHtcbiAgICAgICAgICAgIG1ldGhvZFVuZGVyVGVzdC5jYWxsKHNlcnZpY2VVbmRlclRlc3QsIEFwaS5JZGVudGl0aWVzLCAnZW5kL3BvaW50Jyk7XG5cbiAgICAgICAgICAgIGV4cGVjdChtb3N0UmVjZW50UmVxdWVzdCgpLnVybCkudG9FcXVhbCgnQkFTRS9pZGVudGl0aWVzLWFwaS92MS9lbmQvcG9pbnQ/c2l0ZU5hbWU9UE9SVEFMJyk7XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBpdCgnaXMgY29ycmVjdCB3aXRoIHBhcmFtZXRlcnMnLCAoKSA9PiB7XG4gICAgICAgICAgICBtZXRob2RVbmRlclRlc3QuY2FsbChzZXJ2aWNlVW5kZXJUZXN0LCBBcGkuSWRlbnRpdGllcywgJ2VuZC9wb2ludCcsIHsgcGFyYW1ldGVyczogeyBhOiAnYicsIGM6ICdkJyB9IH0pO1xuXG4gICAgICAgICAgICBleHBlY3QobW9zdFJlY2VudFJlcXVlc3QoKS51cmwpLnRvRXF1YWwoJ0JBU0UvaWRlbnRpdGllcy1hcGkvdjEvZW5kL3BvaW50P2E9YiZjPWQmc2l0ZU5hbWU9UE9SVEFMJyk7XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBpdCgnZGlzcmVnYXJkcyBhIHBhc3NlZC1pbiBzaXRlTmFtZSBwYXJhbWV0ZXInLCAoKSA9PiB7XG4gICAgICAgICAgICBzcHlPbihjb25zb2xlLCAnZXJyb3InKTsgIC8vIEtlZXAgY29uc29sZSBlcnJvciBvdXQgb2YgdGVzdCBvdXRwdXQuXG5cbiAgICAgICAgICAgIG1ldGhvZFVuZGVyVGVzdC5jYWxsKFxuICAgICAgICAgICAgICBzZXJ2aWNlVW5kZXJUZXN0LCBBcGkuSWRlbnRpdGllcywgJ2VuZC9wb2ludCcsIHsgcGFyYW1ldGVyczogeyBhOiAnYicsIGM6ICdkJywgc2l0ZU5hbWU6ICdURVNUJyB9IH1cbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGV4cGVjdChtb3N0UmVjZW50UmVxdWVzdCgpLnVybCkudG9FcXVhbCgnQkFTRS9pZGVudGl0aWVzLWFwaS92MS9lbmQvcG9pbnQ/YT1iJmM9ZCZzaXRlTmFtZT1QT1JUQUwnKTtcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIGl0KCdwcm9wZXJseSBlbmNvZGVzIGEgXFwnK1xcJyB0byBhIFxcJyBcXCcnLCAoKSA9PiB7XG4gICAgICAgICAgICBtZXRob2RVbmRlclRlc3QuY2FsbChcbiAgICAgICAgICAgICAgc2VydmljZVVuZGVyVGVzdCwgQXBpLklkZW50aXRpZXMsICdlbmQvcG9pbnQnLCB7IHBhcmFtZXRlcnM6IHsgYTogJ2IrYycgfSB9XG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBleHBlY3QobW9zdFJlY2VudFJlcXVlc3QoKS51cmwpLnRvRXF1YWwoJ0JBU0UvaWRlbnRpdGllcy1hcGkvdjEvZW5kL3BvaW50P2E9YiUyQmMmc2l0ZU5hbWU9UE9SVEFMJyk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGRlc2NyaWJlKCdoZWFkZXJzJywgKCkgPT4ge1xuICAgICAgICAgIGl0KCdpcyBjb3JyZWN0IHdpdGggbm8gb3B0aW9ucycsICgpID0+IHtcbiAgICAgICAgICAgIG1ldGhvZFVuZGVyVGVzdC5jYWxsKHNlcnZpY2VVbmRlclRlc3QsIEFwaS5JZGVudGl0aWVzLCAnZW5kL3BvaW50Jyk7XG5cbiAgICAgICAgICAgIGV4cGVjdChtb3N0UmVjZW50UmVxdWVzdCgpLmhlYWRlcnMuZ2V0KCdBdXRob3JpemF0aW9uJykpLnRvRXF1YWwoJ1NUQU5EQVJEIFRPS0VOJyk7XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBpdCgnaXMgY29ycmVjdCB3aXRoIG92ZXJyaWRlIHRva2VuJywgKCkgPT4ge1xuICAgICAgICAgICAgbWV0aG9kVW5kZXJUZXN0LmNhbGwoc2VydmljZVVuZGVyVGVzdCwgQXBpLklkZW50aXRpZXMsICdlbmQvcG9pbnQnLCB7IG92ZXJyaWRpbmdUb2tlbjogJ09WRVJSSURJTkcgVE9LRU4nIH0pO1xuXG4gICAgICAgICAgICBleHBlY3QobW9zdFJlY2VudFJlcXVlc3QoKS5oZWFkZXJzLmdldCgnQXV0aG9yaXphdGlvbicpKS50b0VxdWFsKCdPVkVSUklESU5HIFRPS0VOJyk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGRlc2NyaWJlKCdib2R5JywgKCkgPT4ge1xuICAgICAgICAgIGl0KCdpcyBqdXN0IHRoZSBzaXRlIG5hbWUgd2hlbiBubyBib2R5IG9wdGlvbiBpcyBzcGVjaWZpZWQnLCAoKSA9PiB7XG4gICAgICAgICAgICBtZXRob2RVbmRlclRlc3QuY2FsbChzZXJ2aWNlVW5kZXJUZXN0LCBBcGkuSWRlbnRpdGllcywgJ2VuZC9wb2ludCcpO1xuXG4gICAgICAgICAgICBleHBlY3QobW9zdFJlY2VudFJlcXVlc3QoKS5fYm9keSkudG9FcXVhbCgne1wic2l0ZU5hbWVcIjpcIlBPUlRBTFwifScpO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgaXQoJ2lzIHRoZSBzcGVjaWZpZWQgYm9keSBwbHVzIHRoZSBzaXRlIG5hbWUgLSBmb3IgYW4gb2JqZWN0JywgKCkgPT4ge1xuICAgICAgICAgICAgbWV0aG9kVW5kZXJUZXN0LmNhbGwoc2VydmljZVVuZGVyVGVzdCwgQXBpLklkZW50aXRpZXMsICdlbmQvcG9pbnQnLCB7IGJvZHk6IHsgYTogJ2InIH0gfSk7XG5cbiAgICAgICAgICAgIGV4cGVjdChtb3N0UmVjZW50UmVxdWVzdCgpLl9ib2R5KS50b0VxdWFsKCd7XCJhXCI6XCJiXCIsXCJzaXRlTmFtZVwiOlwiUE9SVEFMXCJ9Jyk7XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBpdCgnaXMgdGhlIHNwZWNpZmllZCBib2R5IHBsdXMgdGhlIHNpdGUgbmFtZSAtIGZvciBhbiBhcnJheScsICgpID0+IHtcbiAgICAgICAgICAgIG1ldGhvZFVuZGVyVGVzdC5jYWxsKHNlcnZpY2VVbmRlclRlc3QsIEFwaS5JZGVudGl0aWVzLCAnZW5kL3BvaW50JywgeyBib2R5OiBbMSwgMiwgM10gfSk7XG5cbiAgICAgICAgICAgIGV4cGVjdChtb3N0UmVjZW50UmVxdWVzdCgpLl9ib2R5KS50b0VxdWFsKCdbMSwyLDNdJyk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGRlc2NyaWJlKCdyZXN1bHQnLCAoKSA9PiB7XG4gICAgICAgICAgbGV0IG1vY2tIYW5kbGVyczogYW55O1xuXG4gICAgICAgICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICAgICAgICBtb2NrSGFuZGxlcnMgPSBqYXNtaW5lLmNyZWF0ZVNweU9iaignbW9ja0hhbmRsZXJzJywgWydyZXNwb25zZScsICdlcnJvciddKTtcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIGl0KCdpcyBhcyBleHBlY3RlZCB3aGVuIHRoZSByZXF1ZXN0IHN1Y2NlZWRzJywgKCkgPT4ge1xuICAgICAgICAgICAgbGV0IGFwaVJlc3BvbnNlOiBBcGlSZXNwb25zZTtcblxuICAgICAgICAgICAgbWV0aG9kVW5kZXJUZXN0LmNhbGwoc2VydmljZVVuZGVyVGVzdCwgQXBpLklkZW50aXRpZXMsICdlbmQvcG9pbnQnKS5zdWJzY3JpYmUoXG4gICAgICAgICAgICAgIChyZXNwb25zZTogQXBpUmVzcG9uc2UpID0+IHtcbiAgICAgICAgICAgICAgICBhcGlSZXNwb25zZSA9IHJlc3BvbnNlO1xuICAgICAgICAgICAgICAgIG1vY2tIYW5kbGVycy5yZXNwb25zZSgpO1xuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBtb2NrSGFuZGxlcnMuZXJyb3JcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGV4cGVjdChhcGlSZXNwb25zZSkudG9FcXVhbCh7IHNvbWU6ICdkYXRhJyB9KTtcbiAgICAgICAgICAgIGV4cGVjdChtb2NrSGFuZGxlcnMucmVzcG9uc2UpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgICAgICAgIGV4cGVjdChtb2NrSGFuZGxlcnMuZXJyb3IpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICAgICAgICBleHBlY3QobW9ja05ncnhTdG9yZS5kaXNwYXRjaCkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIGl0KCdpcyBhcyBleHBlY3RlZCB3aGVuIHRoZSByZXF1ZXN0IHN1Y2NlZWRzIHdpdGggYSBub24tSlNPTiByZXNwb25zZScsICgpID0+IHtcbiAgICAgICAgICAgIGxldCBhcGlSZXNwb25zZTogQXBpUmVzcG9uc2U7XG5cbiAgICAgICAgICAgIG1vY2tIdHRwLnJlcXVlc3QgPSBqYXNtaW5lLmNyZWF0ZVNweSgncmVxdWVzdCcpLmFuZC5yZXR1cm5WYWx1ZShPYnNlcnZhYmxlLm9mKCdOb24tSlNPTiEgIEljayEnKSk7XG5cbiAgICAgICAgICAgIG1ldGhvZFVuZGVyVGVzdC5jYWxsKHNlcnZpY2VVbmRlclRlc3QsIEFwaS5JZGVudGl0aWVzLCAnZW5kL3BvaW50Jykuc3Vic2NyaWJlKFxuICAgICAgICAgICAgICAocmVzcG9uc2U6IEFwaVJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICAgICAgYXBpUmVzcG9uc2UgPSByZXNwb25zZTtcbiAgICAgICAgICAgICAgICBtb2NrSGFuZGxlcnMucmVzcG9uc2UoKTtcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgbW9ja0hhbmRsZXJzLmVycm9yXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBleHBlY3QoYXBpUmVzcG9uc2UpLnRvRXF1YWwoJ05vbi1KU09OISAgSWNrIScpO1xuICAgICAgICAgICAgZXhwZWN0KG1vY2tIYW5kbGVycy5yZXNwb25zZSkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgICAgICAgZXhwZWN0KG1vY2tIYW5kbGVycy5lcnJvcikubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgICAgICAgIGV4cGVjdChtb2NrTmdyeFN0b3JlLmRpc3BhdGNoKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgaXQoJ2lzIGFzIGV4cGVjdGVkIHdoZW4gdGhlIHJlcXVlc3QgZXJyb3JzJywgKCkgPT4ge1xuICAgICAgICAgICAgbGV0IGFwaUVycm9yOiBFcnJvcjtcblxuICAgICAgICAgICAgbW9ja0h0dHAucmVxdWVzdCA9IGphc21pbmUuY3JlYXRlU3B5KCdyZXF1ZXN0JykuYW5kLnJldHVyblZhbHVlKE9ic2VydmFibGUudGhyb3coZXJyb3IpKTtcblxuICAgICAgICAgICAgbWV0aG9kVW5kZXJUZXN0LmNhbGwoc2VydmljZVVuZGVyVGVzdCwgQXBpLklkZW50aXRpZXMsICdlbmQvcG9pbnQnKS5zdWJzY3JpYmUoXG4gICAgICAgICAgICAgIG1vY2tIYW5kbGVycy5yZXNwb25zZSxcbiAgICAgICAgICAgICAgKGVycm9yOiBFcnJvcikgPT4ge1xuICAgICAgICAgICAgICAgIGFwaUVycm9yID0gZXJyb3I7XG4gICAgICAgICAgICAgICAgbW9ja0hhbmRsZXJzLmVycm9yKCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGV4cGVjdChhcGlFcnJvcikudG9FcXVhbCh7IHN0YXR1czogNDAxIH0pO1xuICAgICAgICAgICAgZXhwZWN0KG1vY2tIYW5kbGVycy5yZXNwb25zZSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgICAgICAgIGV4cGVjdChtb2NrSGFuZGxlcnMuZXJyb3IpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICAgICAgICAgIGV4cGVjdChtb2NrTmdyeFN0b3JlLmRpc3BhdGNoLmNhbGxzLmFsbEFyZ3MoKSkudG9FcXVhbChbW2Vycm9yQWN0aW9uXV0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICBkZXNjcmliZSgnbG9hZGluZyBpbmRpY2F0b3IgYW5pbWF0aW9uJywgKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IHNob3dBY3Rpb246IExvYWRpbmdJbmRpY2F0b3JBY3Rpb25zLlNob3cgPSBuZXcgTG9hZGluZ0luZGljYXRvckFjdGlvbnMuU2hvdygpO1xuICAgICAgICAgIGNvbnN0IGhpZGVBY3Rpb246IExvYWRpbmdJbmRpY2F0b3JBY3Rpb25zLkhpZGUgPSBuZXcgTG9hZGluZ0luZGljYXRvckFjdGlvbnMuSGlkZSgpO1xuXG4gICAgICAgICAgY29uc3Qgbm9uRXJyb3JBY3Rpb25EaXNwYXRjaGVzID0gKCkgPT5cbiAgICAgICAgICAgIG1vY2tOZ3J4U3RvcmUuZGlzcGF0Y2guY2FsbHMuYWxsQXJncygpLmZpbHRlcigoYXJnOiBhbnkpID0+IGFyZ1swXS50eXBlICE9PSAnW0Vycm9yXSBIYW5kbGUnKTtcblxuICAgICAgICAgIFsnc3VjY2VlZHMnLCAnZXJyb3JzJ10uZm9yRWFjaChyZXN1bHQgPT4ge1xuICAgICAgICAgICAgZGVzY3JpYmUoYHdoZW4gdGhlIHJlcXVlc3QgJHtyZXN1bHR9YCwgKCkgPT4ge1xuICAgICAgICAgICAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgICAgICAgICAgICBtb2NrSHR0cC5yZXF1ZXN0ID0gamFzbWluZS5jcmVhdGVTcHkoJ3JlcXVlc3QnKS5hbmQucmV0dXJuVmFsdWUoXG4gICAgICAgICAgICAgICAgICByZXN1bHQgPT09ICdzdWNjZWVkcycgPyBPYnNlcnZhYmxlLm9mKHN1Y2Nlc3NSZXNwb25zZSkgOiBPYnNlcnZhYmxlLnRocm93KGVycm9yKVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgIGRlc2NyaWJlKCd3aGVuIGxvYWRpbmdJbmRpY2F0b3Igb3B0aW9uIGlzIG5vdCBzcGVjaWZpZWQnLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgaXQoJ2lzIG5vdCBhZmZlY3RlZCcsICgpID0+IHtcbiAgICAgICAgICAgICAgICAgIG1ldGhvZFVuZGVyVGVzdC5jYWxsKHNlcnZpY2VVbmRlclRlc3QsIEFwaS5JZGVudGl0aWVzLCAnZW5kL3BvaW50JylcbiAgICAgICAgICAgICAgICAgICAgLnN1YnNjcmliZSgoKSA9PiB7IH0sICgpID0+IHsgfSk7XG5cbiAgICAgICAgICAgICAgICAgIGV4cGVjdChtb2NrTmdyeFN0b3JlLmRpc3BhdGNoLmNhbGxzLmFsbEFyZ3MoKS5maWx0ZXIoKGFyZzogYW55KSA9PiBhcmdbMF0udHlwZSAhPT0gJ1tFcnJvcl0gSGFuZGxlJykpLnRvRXF1YWwoW10pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICBkZXNjcmliZSgnd2hlbiBsb2FkaW5nSW5kaWNhdG9yIG9wdGlvbiBpcyBmYWxzZScsICgpID0+IHtcbiAgICAgICAgICAgICAgICBpdCgnaXMgbm90IGFmZmVjdGVkJywgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgbWV0aG9kVW5kZXJUZXN0LmNhbGwoc2VydmljZVVuZGVyVGVzdCwgQXBpLklkZW50aXRpZXMsICdlbmQvcG9pbnQnLCB7IGxvYWRpbmdJbmRpY2F0b3I6IGZhbHNlIH0pXG4gICAgICAgICAgICAgICAgICAgIC5zdWJzY3JpYmUoKCkgPT4geyB9LCAoKSA9PiB7IH0pO1xuXG4gICAgICAgICAgICAgICAgICBleHBlY3Qobm9uRXJyb3JBY3Rpb25EaXNwYXRjaGVzKCkpLnRvRXF1YWwoW10pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICBkZXNjcmliZSgnd2hlbiBsb2FkaW5nSW5kaWNhdG9yIG9wdGlvbiBpcyB0cnVlJywgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGl0KCdpcyBzdGFydGVkIHdpdGggdGhlIHJlcXVlc3QgYW5kIHN0b3BwZWQgd2hlbiB0aGUgcmVzcG9uc2UgaXMgcmV0dXJuZWQnLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICBtZXRob2RVbmRlclRlc3QuY2FsbChzZXJ2aWNlVW5kZXJUZXN0LCBBcGkuSWRlbnRpdGllcywgJ2VuZC9wb2ludCcsIHsgbG9hZGluZ0luZGljYXRvcjogdHJ1ZSB9KVxuICAgICAgICAgICAgICAgICAgICAuc3Vic2NyaWJlKCgpID0+IHsgfSwgKCkgPT4geyB9KTtcblxuICAgICAgICAgICAgICAgICAgZXhwZWN0KG5vbkVycm9yQWN0aW9uRGlzcGF0Y2hlcygpKS50b0VxdWFsKFtbc2hvd0FjdGlvbl0sIFtoaWRlQWN0aW9uXV0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICBkZXNjcmliZSgnd2hlbiBsb2FkaW5nSW5kaWNhdG9yIG9wdGlvbiBpcyBvbkJlZm9yZVJlcXVlc3QnLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgaXQoJ2lzIG9ubHkgc3RhcnRlZCB3aXRoIHRoZSByZXF1ZXN0IGFuZCBub3QgdHVybmVkIG9mZiB3aGVuIHRoZSByZXNwb25zZSBpcyByZXR1cm5lZCcsICgpID0+IHtcbiAgICAgICAgICAgICAgICAgIG1ldGhvZFVuZGVyVGVzdC5jYWxsKHNlcnZpY2VVbmRlclRlc3QsIEFwaS5JZGVudGl0aWVzLCAnZW5kL3BvaW50JywgeyBsb2FkaW5nSW5kaWNhdG9yOiAnb25CZWZvcmVSZXF1ZXN0JyB9KVxuICAgICAgICAgICAgICAgICAgICAuc3Vic2NyaWJlKCgpID0+IHsgfSwgKCkgPT4geyB9KTtcblxuICAgICAgICAgICAgICAgICAgZXhwZWN0KG5vbkVycm9yQWN0aW9uRGlzcGF0Y2hlcygpKS50b0VxdWFsKFtbc2hvd0FjdGlvbl1dKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgZGVzY3JpYmUoJ3doZW4gbG9hZGluZ0luZGljYXRvciBvcHRpb24gaXMgb2ZmQWZ0ZXJSZXNwb25zZScsICgpID0+IHtcbiAgICAgICAgICAgICAgICBpdCgnaXMgbm90IHN0YXJ0ZWQgd2l0aCB0aGUgcmVxdWVzdCBidXQgaXMgc3RvcHBlZCB3aGVuIHRoZSByZXNwb25zZSBpcyByZXR1cm5lZCcsICgpID0+IHtcbiAgICAgICAgICAgICAgICAgIG1ldGhvZFVuZGVyVGVzdC5jYWxsKHNlcnZpY2VVbmRlclRlc3QsIEFwaS5JZGVudGl0aWVzLCAnZW5kL3BvaW50JywgeyBsb2FkaW5nSW5kaWNhdG9yOiAnb2ZmQWZ0ZXJSZXNwb25zZScgfSlcbiAgICAgICAgICAgICAgICAgICAgLnN1YnNjcmliZSgoKSA9PiB7IH0sICgpID0+IHsgfSk7XG5cbiAgICAgICAgICAgICAgICAgIGV4cGVjdChub25FcnJvckFjdGlvbkRpc3BhdGNoZXMoKSkudG9FcXVhbChbW2hpZGVBY3Rpb25dXSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xufVxuIl19
