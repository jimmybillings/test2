"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var collections_store_1 = require("./collections.store");
var reducer_1 = require("../tests/reducer");
var Observable_1 = require("rxjs/Observable");
var common_functions_1 = require("../utilities/common.functions");
function main() {
    var initialState = {
        items: [],
        pagination: {
            totalCount: 0,
            currentPage: 1,
            pageSize: 100,
            hasNextPage: false,
            hasPreviousPage: false,
            numberOfPages: 0
        }
    };
    describe('REPLACE_COLLECTIONS', function () {
        reducer_1.addStandardReducerTestsFor(collections_store_1.collections, 'REPLACE_COLLECTIONS', initialState);
        it('returns payload when current state is passed in', function () {
            expect(collections_store_1.collections({ property1: 'existing1', property2: 'existing2' }, { type: 'REPLACE_COLLECTIONS', payload: { property1: 'new', other: 'stuff' } }))
                .toEqual({ property1: 'new', other: 'stuff' });
        });
        it('returns payload when current state is not passed in', function () {
            expect(collections_store_1.collections(undefined, { type: 'REPLACE_COLLECTIONS', payload: { some: 'payload' } }))
                .toEqual({ some: 'payload' });
        });
        it('returns initial state when payload is not passed in', function () {
            expect(collections_store_1.collections({ property1: 'existing1', property2: 'existing2' }, { type: 'REPLACE_COLLECTIONS' }))
                .toEqual(initialState);
        });
    });
    describe('ADD_COLLECTION', function () {
        reducer_1.addStandardReducerTestsFor(collections_store_1.collections, 'ADD_COLLECTION', initialState);
        it('returns current state merged with payload when current state is passed in', function () {
            expect(collections_store_1.collections({ items: [{ collection: '1' }, { collection: '2' }] }, { type: 'ADD_COLLECTION', payload: { collection: '3' } }))
                .toEqual({ items: [{ collection: '1' }, { collection: '2' }, { collection: '3' }] });
        });
        it('returns initial state merged with payload when current state is not passed in', function () {
            var expectedResult = common_functions_1.Common.clone(initialState);
            expectedResult.items = [{ collection: '42' }];
            expect(collections_store_1.collections(undefined, { type: 'ADD_COLLECTION', payload: { collection: '42' } }))
                .toEqual(expectedResult);
        });
        it('returns current state merged with payload when current state does not define items', function () {
            expect(collections_store_1.collections({ some: 'nonitems' }, { type: 'ADD_COLLECTION', payload: { collection: '123' } }))
                .toEqual({ some: 'nonitems', items: [{ collection: '123' }] });
        });
        it('returns current state unchanged when payload is not passed in', function () {
            expect(collections_store_1.collections({ items: [{ collection: '1' }, { collection: '2' }] }, { type: 'ADD_COLLECTION' }))
                .toEqual({ items: [{ collection: '1' }, { collection: '2' }] });
        });
    });
    describe('UPDATE_COLLECTION', function () {
        var tempInitialState = { items: [{ id: 42, content: 'original' }] };
        var tempPayload = { id: 42, content: 'new' };
        reducer_1.addStandardReducerTestsFor(collections_store_1.collections, 'UPDATE_COLLECTION', tempInitialState, tempPayload);
        it('returns current state updated with payload collection when current state is passed in', function () {
            expect(collections_store_1.collections(tempInitialState, { type: 'UPDATE_COLLECTION', payload: tempPayload }))
                .toEqual({ items: [{ id: 42, content: 'new' }] });
        });
        it('returns initial state unchanged when current state is not passed in', function () {
            expect(collections_store_1.collections(undefined, { type: 'UPDATE_COLLECTION', payload: tempPayload }))
                .toEqual(initialState);
        });
        it('returns current state unchanged when payload is a nonexistent collection', function () {
            expect(collections_store_1.collections(tempInitialState, { type: 'UPDATE_COLLECTION', payload: { id: 17, content: 'whatever' } }))
                .toEqual({ items: [{ id: 42, content: 'original' }] });
        });
        it('returns current state unchanged when current state does not define items', function () {
            expect(collections_store_1.collections({ some: 'nonitems' }, { type: 'UPDATE_COLLECTION', payload: tempPayload }))
                .toEqual({ some: 'nonitems' });
        });
        it('returns current state unchanged when payload is not passed in', function () {
            expect(collections_store_1.collections(tempInitialState, { type: 'UPDATE_COLLECTION' }))
                .toEqual(tempInitialState);
        });
    });
    describe('DELETE_COLLECTION', function () {
        var tempInitialState = { items: [{ id: 25, content: 'whatever' }] };
        var tempPayload = 25;
        reducer_1.addStandardReducerTestsFor(collections_store_1.collections, 'DELETE_COLLECTION', tempInitialState, tempPayload);
        it('returns current state minus the collection with the payload ID when current state is passed in', function () {
            expect(collections_store_1.collections({ items: [{ id: 123 }, { id: 456 }] }, { type: 'DELETE_COLLECTION', payload: 123 }))
                .toEqual({ items: [{ id: 456 }] });
        });
        it('returns initial state when current state is not passed in', function () {
            expect(collections_store_1.collections(undefined, { type: 'DELETE_COLLECTION', payload: 123 }))
                .toEqual(initialState);
        });
        it('returns current state unchanged when current state does not define items', function () {
            expect(collections_store_1.collections({ some: 'nonitems' }, { type: 'DELETE_COLLECTION', payload: 99 }))
                .toEqual({ some: 'nonitems' });
        });
        it('returns current state unchanged when payload is not passed in', function () {
            expect(collections_store_1.collections(tempInitialState, { type: 'DELETE_COLLECTION' }))
                .toEqual(tempInitialState);
        });
    });
    describe('DELETE_ALL_COLLECTIONS', function () {
        it('returns initial state when current state is passed in', function () {
            expect(collections_store_1.collections({ property1: 'existing1', property2: 'existing2' }, { type: 'DELETE_ALL_COLLECTIONS' }))
                .toEqual(initialState);
        });
        it('returns initial state when current state is not passed in', function () {
            expect(collections_store_1.collections(undefined, { type: 'DELETE_ALL_COLLECTIONS' }))
                .toEqual(initialState);
        });
    });
}
exports.main = main;
;
describe('Collections Store', function () {
    var storeUnderTest, mockStore;
    beforeEach(function () {
        mockStore = {
            select: jasmine.createSpy('select').and.returnValue(Observable_1.Observable.of({ someKey: 'someValue' })),
            dispatch: jasmine.createSpy('dispatch')
        };
        storeUnderTest = new collections_store_1.CollectionsStore(mockStore);
    });
    describe('data getter', function () {
        it('accesses the right part of the global store', function () {
            storeUnderTest.data.subscribe();
            expect(mockStore.select).toHaveBeenCalledWith('collections');
        });
        it('returns the expected data', function () {
            storeUnderTest.data.subscribe(function (data) {
                expect(data).toEqual({ someKey: 'someValue' });
            });
        });
    });
    describe('state getter', function () {
        it('should return the state', function () {
            expect(storeUnderTest.state).toEqual({ someKey: 'someValue' });
        });
    });
    describe('deleteAllCollections()', function () {
        it('should dispatch DELETE_ALL_COLLECTIONS', function () {
            storeUnderTest.deleteAllCollections();
            expect(mockStore.dispatch).toHaveBeenCalledWith({ type: 'DELETE_ALL_COLLECTIONS' });
        });
    });
    describe('deleteCollectionWith()', function () {
        it('should dispatch DELETE_COLLECTION with the collectionId', function () {
            storeUnderTest.deleteCollectionWith(123);
            expect(mockStore.dispatch).toHaveBeenCalledWith({ type: 'DELETE_COLLECTION', payload: 123 });
        });
    });
    describe('add()', function () {
        it('should dispatch ADD_COLLECTION with the new collection', function () {
            var newCollection = { id: 1, name: 'Cat', owner: 12, lastUpdated: null, createdOn: null, siteName: 'core' };
            storeUnderTest.add(newCollection);
            expect(mockStore.dispatch).toHaveBeenCalledWith({ type: 'ADD_COLLECTION', payload: newCollection });
        });
    });
    describe('update()', function () {
        it('should dispatch UPDATE_COLLECTION with the updated collection', function () {
            var updatedCollection = { id: 1, name: 'Dog', owner: 12, lastUpdated: null, createdOn: null, siteName: 'core' };
            storeUnderTest.update(updatedCollection);
            expect(mockStore.dispatch).toHaveBeenCalledWith({ type: 'UPDATE_COLLECTION', payload: updatedCollection });
        });
    });
    describe('replaceAllCollectionsWith()', function () {
        it('should replace with the items passed in', function () {
            var collection = { id: 1, name: 'Dogs', owner: 12, lastUpdated: null, createdOn: null, siteName: 'core' };
            var replacements = {
                items: [collection], totalCount: 1, currentPage: 0,
                hasNextPage: false, hasPreviousPage: false, numberOfPages: 1, pageSize: 1
            };
            storeUnderTest.replaceAllCollectionsWith(replacements);
            expect(mockStore.dispatch).toHaveBeenCalledWith({
                type: 'REPLACE_COLLECTIONS',
                payload: {
                    items: [collection],
                    pagination: { totalCount: 1, currentPage: 1, hasNextPage: false, hasPreviousPage: false, numberOfPages: 1, pageSize: 1 }
                }
            });
        });
        it('should replace with an empty array if there are no items', function () {
            var replacements = { totalCount: 0, currentPage: 0, hasNextPage: false, hasPreviousPage: false, numberOfPages: 1, pageSize: 0 };
            storeUnderTest.replaceAllCollectionsWith(replacements);
            expect(mockStore.dispatch).toHaveBeenCalledWith({
                type: 'REPLACE_COLLECTIONS',
                payload: {
                    items: [],
                    pagination: { totalCount: 0, currentPage: 1, hasNextPage: false, hasPreviousPage: false, numberOfPages: 1, pageSize: 0 }
                }
            });
        });
    });
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC9zaGFyZWQvc3RvcmVzL2NvbGxlY3Rpb25zLnN0b3JlLnNwZWMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSx5REFBb0U7QUFFcEUsNENBQThEO0FBQzlELDhDQUE2QztBQUM3QyxrRUFBdUQ7QUFFdkQ7SUFDRSxJQUFNLFlBQVksR0FBc0I7UUFDdEMsS0FBSyxFQUFFLEVBQUU7UUFDVCxVQUFVLEVBQUU7WUFDVixVQUFVLEVBQUUsQ0FBQztZQUNiLFdBQVcsRUFBRSxDQUFDO1lBQ2QsUUFBUSxFQUFFLEdBQUc7WUFDYixXQUFXLEVBQUUsS0FBSztZQUNsQixlQUFlLEVBQUUsS0FBSztZQUN0QixhQUFhLEVBQUUsQ0FBQztTQUNqQjtLQUNGLENBQUM7SUFFRixRQUFRLENBQUMscUJBQXFCLEVBQUU7UUFDOUIsb0NBQTBCLENBQUMsK0JBQVcsRUFBRSxxQkFBcUIsRUFBRSxZQUFZLENBQUMsQ0FBQztRQUU3RSxFQUFFLENBQUMsaURBQWlELEVBQUU7WUFDcEQsTUFBTSxDQUFDLCtCQUFXLENBQ2hCLEVBQUUsU0FBUyxFQUFFLFdBQVcsRUFBRSxTQUFTLEVBQUUsV0FBVyxFQUFTLEVBQ3pELEVBQUUsSUFBSSxFQUFFLHFCQUFxQixFQUFFLE9BQU8sRUFBRSxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxFQUFFLENBQy9FLENBQUM7aUJBQ0MsT0FBTyxDQUFDLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFLENBQUMsQ0FBQztRQUNuRCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxxREFBcUQsRUFBRTtZQUN4RCxNQUFNLENBQUMsK0JBQVcsQ0FBQyxTQUFTLEVBQUUsRUFBRSxJQUFJLEVBQUUscUJBQXFCLEVBQUUsT0FBTyxFQUFFLEVBQUUsSUFBSSxFQUFFLFNBQVMsRUFBRSxFQUFFLENBQUMsQ0FBQztpQkFDMUYsT0FBTyxDQUFDLEVBQUUsSUFBSSxFQUFF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LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY29sbGVjdGlvbnMsIENvbGxlY3Rpb25zU3RvcmUgfSBmcm9tICcuL2NvbGxlY3Rpb25zLnN0b3JlJztcbmltcG9ydCB7IENvbGxlY3Rpb24sIENvbGxlY3Rpb25zU3RvcmVJIH0gZnJvbSAnLi4vaW50ZXJmYWNlcy9jb2xsZWN0aW9uLmludGVyZmFjZSc7XG5pbXBvcnQgeyBhZGRTdGFuZGFyZFJlZHVjZXJUZXN0c0ZvciB9IGZyb20gJy4uL3Rlc3RzL3JlZHVjZXInO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMvT2JzZXJ2YWJsZSc7XG5pbXBvcnQgeyBDb21tb24gfSBmcm9tICcuLi91dGlsaXRpZXMvY29tbW9uLmZ1bmN0aW9ucyc7XG5cbmV4cG9ydCBmdW5jdGlvbiBtYWluKCkge1xuICBjb25zdCBpbml0aWFsU3RhdGU6IENvbGxlY3Rpb25zU3RvcmVJID0ge1xuICAgIGl0ZW1zOiBbXSxcbiAgICBwYWdpbmF0aW9uOiB7XG4gICAgICB0b3RhbENvdW50OiAwLFxuICAgICAgY3VycmVudFBhZ2U6IDEsXG4gICAgICBwYWdlU2l6ZTogMTAwLFxuICAgICAgaGFzTmV4dFBhZ2U6IGZhbHNlLFxuICAgICAgaGFzUHJldmlvdXNQYWdlOiBmYWxzZSxcbiAgICAgIG51bWJlck9mUGFnZXM6IDBcbiAgICB9XG4gIH07XG5cbiAgZGVzY3JpYmUoJ1JFUExBQ0VfQ09MTEVDVElPTlMnLCAoKSA9PiB7XG4gICAgYWRkU3RhbmRhcmRSZWR1Y2VyVGVzdHNGb3IoY29sbGVjdGlvbnMsICdSRVBMQUNFX0NPTExFQ1RJT05TJywgaW5pdGlhbFN0YXRlKTtcblxuICAgIGl0KCdyZXR1cm5zIHBheWxvYWQgd2hlbiBjdXJyZW50IHN0YXRlIGlzIHBhc3NlZCBpbicsICgpID0+IHtcbiAgICAgIGV4cGVjdChjb2xsZWN0aW9ucyhcbiAgICAgICAgeyBwcm9wZXJ0eTE6ICdleGlzdGluZzEnLCBwcm9wZXJ0eTI6ICdleGlzdGluZzInIH0gYXMgYW55LFxuICAgICAgICB7IHR5cGU6ICdSRVBMQUNFX0NPTExFQ1RJT05TJywgcGF5bG9hZDogeyBwcm9wZXJ0eTE6ICduZXcnLCBvdGhlcjogJ3N0dWZmJyB9IH1cbiAgICAgICkpXG4gICAgICAgIC50b0VxdWFsKHsgcHJvcGVydHkxOiAnbmV3Jywgb3RoZXI6ICdzdHVmZicgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgncmV0dXJucyBwYXlsb2FkIHdoZW4gY3VycmVudCBzdGF0ZSBpcyBub3QgcGFzc2VkIGluJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KGNvbGxlY3Rpb25zKHVuZGVmaW5lZCwgeyB0eXBlOiAnUkVQTEFDRV9DT0xMRUNUSU9OUycsIHBheWxvYWQ6IHsgc29tZTogJ3BheWxvYWQnIH0gfSkpXG4gICAgICAgIC50b0VxdWFsKHsgc29tZTogJ3BheWxvYWQnIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3JldHVybnMgaW5pdGlhbCBzdGF0ZSB3aGVuIHBheWxvYWQgaXMgbm90IHBhc3NlZCBpbicsICgpID0+IHtcbiAgICAgIGV4cGVjdChjb2xsZWN0aW9ucyhcbiAgICAgICAgeyBwcm9wZXJ0eTE6ICdleGlzdGluZzEnLCBwcm9wZXJ0eTI6ICdleGlzdGluZzInIH0gYXMgYW55LFxuICAgICAgICB7IHR5cGU6ICdSRVBMQUNFX0NPTExFQ1RJT05TJyB9XG4gICAgICApKVxuICAgICAgICAudG9FcXVhbChpbml0aWFsU3RhdGUpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnQUREX0NPTExFQ1RJT04nLCAoKSA9PiB7XG4gICAgYWRkU3RhbmRhcmRSZWR1Y2VyVGVzdHNGb3IoY29sbGVjdGlvbnMsICdBRERfQ09MTEVDVElPTicsIGluaXRpYWxTdGF0ZSk7XG5cbiAgICBpdCgncmV0dXJucyBjdXJyZW50IHN0YXRlIG1lcmdlZCB3aXRoIHBheWxvYWQgd2hlbiBjdXJyZW50IHN0YXRlIGlzIHBhc3NlZCBpbicsICgpID0+IHtcbiAgICAgIGV4cGVjdChjb2xsZWN0aW9ucyhcbiAgICAgICAgeyBpdGVtczogW3sgY29sbGVjdGlvbjogJzEnIH0sIHsgY29sbGVjdGlvbjogJzInIH1dIH0gYXMgYW55LFxuICAgICAgICB7IHR5cGU6ICdBRERfQ09MTEVDVElPTicsIHBheWxvYWQ6IHsgY29sbGVjdGlvbjogJzMnIH0gfVxuICAgICAgKSlcbiAgICAgICAgLnRvRXF1YWwoeyBpdGVtczogW3sgY29sbGVjdGlvbjogJzEnIH0sIHsgY29sbGVjdGlvbjogJzInIH0sIHsgY29sbGVjdGlvbjogJzMnIH1dIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3JldHVybnMgaW5pdGlhbCBzdGF0ZSBtZXJnZWQgd2l0aCBwYXlsb2FkIHdoZW4gY3VycmVudCBzdGF0ZSBpcyBub3QgcGFzc2VkIGluJywgKCkgPT4ge1xuICAgICAgY29uc3QgZXhwZWN0ZWRSZXN1bHQgPSBDb21tb24uY2xvbmUoaW5pdGlhbFN0YXRlKSBhcyBhbnk7XG4gICAgICBleHBlY3RlZFJlc3VsdC5pdGVtcyA9IFt7IGNvbGxlY3Rpb246ICc0MicgfV07XG5cbiAgICAgIGV4cGVjdChjb2xsZWN0aW9ucyh1bmRlZmluZWQsIHsgdHlwZTogJ0FERF9DT0xMRUNUSU9OJywgcGF5bG9hZDogeyBjb2xsZWN0aW9uOiAnNDInIH0gfSkpXG4gICAgICAgIC50b0VxdWFsKGV4cGVjdGVkUmVzdWx0KTtcbiAgICB9KTtcblxuICAgIGl0KCdyZXR1cm5zIGN1cnJlbnQgc3RhdGUgbWVyZ2VkIHdpdGggcGF5bG9hZCB3aGVuIGN1cnJlbnQgc3RhdGUgZG9lcyBub3QgZGVmaW5lIGl0ZW1zJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KGNvbGxlY3Rpb25zKFxuICAgICAgICB7IHNvbWU6ICdub25pdGVtcycgfSBhcyBhbnksXG4gICAgICAgIHsgdHlwZTogJ0FERF9DT0xMRUNUSU9OJywgcGF5bG9hZDogeyBjb2xsZWN0aW9uOiAnMTIzJyB9IH1cbiAgICAgICkpXG4gICAgICAgIC50b0VxdWFsKHsgc29tZTogJ25vbml0ZW1zJywgaXRlbXM6IFt7IGNvbGxlY3Rpb246ICcxMjMnIH1dIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3JldHVybnMgY3VycmVudCBzdGF0ZSB1bmNoYW5nZWQgd2hlbiBwYXlsb2FkIGlzIG5vdCBwYXNzZWQgaW4nLCAoKSA9PiB7XG4gICAgICBleHBlY3QoY29sbGVjdGlvbnMoXG4gICAgICAgIHsgaXRlbXM6IFt7IGNvbGxlY3Rpb246ICcxJyB9LCB7IGNvbGxlY3Rpb246ICcyJyB9XSB9IGFzIGFueSxcbiAgICAgICAgeyB0eXBlOiAnQUREX0NPTExFQ1RJT04nIH1cbiAgICAgICkpXG4gICAgICAgIC50b0VxdWFsKHsgaXRlbXM6IFt7IGNvbGxlY3Rpb246ICcxJyB9LCB7IGNvbGxlY3Rpb246ICcyJyB9XSB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1VQREFURV9DT0xMRUNUSU9OJywgKCkgPT4ge1xuICAgIGNvbnN0IHRlbXBJbml0aWFsU3RhdGUgPSB7IGl0ZW1zOiBbeyBpZDogNDIsIGNvbnRlbnQ6ICdvcmlnaW5hbCcgfV0gfTtcbiAgICBjb25zdCB0ZW1wUGF5bG9hZCA9IHsgaWQ6IDQyLCBjb250ZW50OiAnbmV3JyB9O1xuXG4gICAgYWRkU3RhbmRhcmRSZWR1Y2VyVGVzdHNGb3IoY29sbGVjdGlvbnMsICdVUERBVEVfQ09MTEVDVElPTicsIHRlbXBJbml0aWFsU3RhdGUsIHRlbXBQYXlsb2FkKTtcblxuICAgIGl0KCdyZXR1cm5zIGN1cnJlbnQgc3RhdGUgdXBkYXRlZCB3aXRoIHBheWxvYWQgY29sbGVjdGlvbiB3aGVuIGN1cnJlbnQgc3RhdGUgaXMgcGFzc2VkIGluJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KGNvbGxlY3Rpb25zKHRlbXBJbml0aWFsU3RhdGUgYXMgYW55LCB7IHR5cGU6ICdVUERBVEVfQ09MTEVDVElPTicsIHBheWxvYWQ6IHRlbXBQYXlsb2FkIH0pKVxuICAgICAgICAudG9FcXVhbCh7IGl0ZW1zOiBbeyBpZDogNDIsIGNvbnRlbnQ6ICduZXcnIH1dIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3JldHVybnMgaW5pdGlhbCBzdGF0ZSB1bmNoYW5nZWQgd2hlbiBjdXJyZW50IHN0YXRlIGlzIG5vdCBwYXNzZWQgaW4nLCAoKSA9PiB7XG4gICAgICBleHBlY3QoY29sbGVjdGlvbnModW5kZWZpbmVkLCB7IHR5cGU6ICdVUERBVEVfQ09MTEVDVElPTicsIHBheWxvYWQ6IHRlbXBQYXlsb2FkIH0pKVxuICAgICAgICAudG9FcXVhbChpbml0aWFsU3RhdGUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3JldHVybnMgY3VycmVudCBzdGF0ZSB1bmNoYW5nZWQgd2hlbiBwYXlsb2FkIGlzIGEgbm9uZXhpc3RlbnQgY29sbGVjdGlvbicsICgpID0+IHtcbiAgICAgIGV4cGVjdChjb2xsZWN0aW9ucyh0ZW1wSW5pdGlhbFN0YXRlIGFzIGFueSwgeyB0eXBlOiAnVVBEQVRFX0NPTExFQ1RJT04nLCBwYXlsb2FkOiB7IGlkOiAxNywgY29udGVudDogJ3doYXRldmVyJyB9IH0pKVxuICAgICAgICAudG9FcXVhbCh7IGl0ZW1zOiBbeyBpZDogNDIsIGNvbnRlbnQ6ICdvcmlnaW5hbCcgfV0gfSk7XG4gICAgfSk7XG5cbiAgICBpdCgncmV0dXJucyBjdXJyZW50IHN0YXRlIHVuY2hhbmdlZCB3aGVuIGN1cnJlbnQgc3RhdGUgZG9lcyBub3QgZGVmaW5lIGl0ZW1zJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KGNvbGxlY3Rpb25zKHsgc29tZTogJ25vbml0ZW1zJyB9IGFzIGFueSwgeyB0eXBlOiAnVVBEQVRFX0NPTExFQ1RJT04nLCBwYXlsb2FkOiB0ZW1wUGF5bG9hZCB9KSlcbiAgICAgICAgLnRvRXF1YWwoeyBzb21lOiAnbm9uaXRlbXMnIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3JldHVybnMgY3VycmVudCBzdGF0ZSB1bmNoYW5nZWQgd2hlbiBwYXlsb2FkIGlzIG5vdCBwYXNzZWQgaW4nLCAoKSA9PiB7XG4gICAgICBleHBlY3QoY29sbGVjdGlvbnModGVtcEluaXRpYWxTdGF0ZSBhcyBhbnksIHsgdHlwZTogJ1VQREFURV9DT0xMRUNUSU9OJyB9KSlcbiAgICAgICAgLnRvRXF1YWwodGVtcEluaXRpYWxTdGF0ZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdERUxFVEVfQ09MTEVDVElPTicsICgpID0+IHtcbiAgICBjb25zdCB0ZW1wSW5pdGlhbFN0YXRlID0geyBpdGVtczogW3sgaWQ6IDI1LCBjb250ZW50OiAnd2hhdGV2ZXInIH1dIH07XG4gICAgY29uc3QgdGVtcFBheWxvYWQgPSAyNTtcblxuICAgIGFkZFN0YW5kYXJkUmVkdWNlclRlc3RzRm9yKGNvbGxlY3Rpb25zLCAnREVMRVRFX0NPTExFQ1RJT04nLCB0ZW1wSW5pdGlhbFN0YXRlLCB0ZW1wUGF5bG9hZCk7XG5cbiAgICBpdCgncmV0dXJucyBjdXJyZW50IHN0YXRlIG1pbnVzIHRoZSBjb2xsZWN0aW9uIHdpdGggdGhlIHBheWxvYWQgSUQgd2hlbiBjdXJyZW50IHN0YXRlIGlzIHBhc3NlZCBpbicsICgpID0+IHtcbiAgICAgIGV4cGVjdChjb2xsZWN0aW9ucyhcbiAgICAgICAgeyBpdGVtczogW3sgaWQ6IDEyMyB9LCB7IGlkOiA0NTYgfV0gfSBhcyBhbnksXG4gICAgICAgIHsgdHlwZTogJ0RFTEVURV9DT0xMRUNUSU9OJywgcGF5bG9hZDogMTIzIH1cbiAgICAgICkpXG4gICAgICAgIC50b0VxdWFsKHsgaXRlbXM6IFt7IGlkOiA0NTYgfV0gfSk7XG4gICAgfSk7XG5cbiAgICBpdCgncmV0dXJucyBpbml0aWFsIHN0YXRlIHdoZW4gY3VycmVudCBzdGF0ZSBpcyBub3QgcGFzc2VkIGluJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KGNvbGxlY3Rpb25zKHVuZGVmaW5lZCwgeyB0eXBlOiAnREVMRVRFX0NPTExFQ1RJT04nLCBwYXlsb2FkOiAxMjMgfSkpXG4gICAgICAgIC50b0VxdWFsKGluaXRpYWxTdGF0ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgncmV0dXJucyBjdXJyZW50IHN0YXRlIHVuY2hhbmdlZCB3aGVuIGN1cnJlbnQgc3RhdGUgZG9lcyBub3QgZGVmaW5lIGl0ZW1zJywgKCkgPT4ge1xuICAgICAgZXhwZWN0KGNvbGxlY3Rpb25zKHsgc29tZTogJ25vbml0ZW1zJyB9IGFzIGFueSwgeyB0eXBlOiAnREVMRVRFX0NPTExFQ1RJT04nLCBwYXlsb2FkOiA5OSB9KSlcbiAgICAgICAgLnRvRXF1YWwoeyBzb21lOiAnbm9uaXRlbXMnIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3JldHVybnMgY3VycmVudCBzdGF0ZSB1bmNoYW5nZWQgd2hlbiBwYXlsb2FkIGlzIG5vdCBwYXNzZWQgaW4nLCAoKSA9PiB7XG4gICAgICBleHBlY3QoY29sbGVjdGlvbnModGVtcEluaXRpYWxTdGF0ZSBhcyBhbnksIHsgdHlwZTogJ0RFTEVURV9DT0xMRUNUSU9OJyB9KSlcbiAgICAgICAgLnRvRXF1YWwodGVtcEluaXRpYWxTdGF0ZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdERUxFVEVfQUxMX0NPTExFQ1RJT05TJywgKCkgPT4ge1xuICAgIGl0KCdyZXR1cm5zIGluaXRpYWwgc3RhdGUgd2hlbiBjdXJyZW50IHN0YXRlIGlzIHBhc3NlZCBpbicsICgpID0+IHtcbiAgICAgIGV4cGVjdChjb2xsZWN0aW9ucyhcbiAgICAgICAgeyBwcm9wZXJ0eTE6ICdleGlzdGluZzEnLCBwcm9wZXJ0eTI6ICdleGlzdGluZzInIH0gYXMgYW55LFxuICAgICAgICB7IHR5cGU6ICdERUxFVEVfQUxMX0NPTExFQ1RJT05TJyB9XG4gICAgICApKVxuICAgICAgICAudG9FcXVhbChpbml0aWFsU3RhdGUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3JldHVybnMgaW5pdGlhbCBzdGF0ZSB3aGVuIGN1cnJlbnQgc3RhdGUgaXMgbm90IHBhc3NlZCBpbicsICgpID0+IHtcbiAgICAgIGV4cGVjdChjb2xsZWN0aW9ucyh1bmRlZmluZWQsIHsgdHlwZTogJ0RFTEVURV9BTExfQ09MTEVDVElPTlMnIH0pKVxuICAgICAgICAudG9FcXVhbChpbml0aWFsU3RhdGUpO1xuICAgIH0pO1xuICB9KTtcbn07XG5cbmRlc2NyaWJlKCdDb2xsZWN0aW9ucyBTdG9yZScsICgpID0+IHtcbiAgbGV0IHN0b3JlVW5kZXJUZXN0OiBDb2xsZWN0aW9uc1N0b3JlLCBtb2NrU3RvcmU6IGFueTtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBtb2NrU3RvcmUgPSB7XG4gICAgICBzZWxlY3Q6IGphc21pbmUuY3JlYXRlU3B5KCdzZWxlY3QnKS5hbmQucmV0dXJuVmFsdWUoT2JzZXJ2YWJsZS5vZih7IHNvbWVLZXk6ICdzb21lVmFsdWUnIH0pKSxcbiAgICAgIGRpc3BhdGNoOiBqYXNtaW5lLmNyZWF0ZVNweSgnZGlzcGF0Y2gnKVxuICAgIH07XG4gICAgc3RvcmVVbmRlclRlc3QgPSBuZXcgQ29sbGVjdGlvbnNTdG9yZShtb2NrU3RvcmUpO1xuICB9KTtcblxuICBkZXNjcmliZSgnZGF0YSBnZXR0ZXInLCAoKSA9PiB7XG4gICAgaXQoJ2FjY2Vzc2VzIHRoZSByaWdodCBwYXJ0IG9mIHRoZSBnbG9iYWwgc3RvcmUnLCAoKSA9PiB7XG4gICAgICBzdG9yZVVuZGVyVGVzdC5kYXRhLnN1YnNjcmliZSgpO1xuICAgICAgZXhwZWN0KG1vY2tTdG9yZS5zZWxlY3QpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdjb2xsZWN0aW9ucycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3JldHVybnMgdGhlIGV4cGVjdGVkIGRhdGEnLCAoKSA9PiB7XG4gICAgICBzdG9yZVVuZGVyVGVzdC5kYXRhLnN1YnNjcmliZShkYXRhID0+IHtcbiAgICAgICAgZXhwZWN0KGRhdGEpLnRvRXF1YWwoeyBzb21lS2V5OiAnc29tZVZhbHVlJyB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnc3RhdGUgZ2V0dGVyJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIHRoZSBzdGF0ZScsICgpID0+IHtcbiAgICAgIGV4cGVjdChzdG9yZVVuZGVyVGVzdC5zdGF0ZSkudG9FcXVhbCh7IHNvbWVLZXk6ICdzb21lVmFsdWUnIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZGVsZXRlQWxsQ29sbGVjdGlvbnMoKScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGRpc3BhdGNoIERFTEVURV9BTExfQ09MTEVDVElPTlMnLCAoKSA9PiB7XG4gICAgICBzdG9yZVVuZGVyVGVzdC5kZWxldGVBbGxDb2xsZWN0aW9ucygpO1xuXG4gICAgICBleHBlY3QobW9ja1N0b3JlLmRpc3BhdGNoKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7IHR5cGU6ICdERUxFVEVfQUxMX0NPTExFQ1RJT05TJyB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2RlbGV0ZUNvbGxlY3Rpb25XaXRoKCknLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBkaXNwYXRjaCBERUxFVEVfQ09MTEVDVElPTiB3aXRoIHRoZSBjb2xsZWN0aW9uSWQnLCAoKSA9PiB7XG4gICAgICBzdG9yZVVuZGVyVGVzdC5kZWxldGVDb2xsZWN0aW9uV2l0aCgxMjMpO1xuXG4gICAgICBleHBlY3QobW9ja1N0b3JlLmRpc3BhdGNoKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7IHR5cGU6ICdERUxFVEVfQ09MTEVDVElPTicsIHBheWxvYWQ6IDEyMyB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2FkZCgpJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZGlzcGF0Y2ggQUREX0NPTExFQ1RJT04gd2l0aCB0aGUgbmV3IGNvbGxlY3Rpb24nLCAoKSA9PiB7XG4gICAgICBsZXQgbmV3Q29sbGVjdGlvbjogQ29sbGVjdGlvbiA9IHsgaWQ6IDEsIG5hbWU6ICdDYXQnLCBvd25lcjogMTIsIGxhc3RVcGRhdGVkOiBudWxsLCBjcmVhdGVkT246IG51bGwsIHNpdGVOYW1lOiAnY29yZScgfTtcbiAgICAgIHN0b3JlVW5kZXJUZXN0LmFkZChuZXdDb2xsZWN0aW9uKTtcblxuICAgICAgZXhwZWN0KG1vY2tTdG9yZS5kaXNwYXRjaCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoeyB0eXBlOiAnQUREX0NPTExFQ1RJT04nLCBwYXlsb2FkOiBuZXdDb2xsZWN0aW9uIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgndXBkYXRlKCknLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBkaXNwYXRjaCBVUERBVEVfQ09MTEVDVElPTiB3aXRoIHRoZSB1cGRhdGVkIGNvbGxlY3Rpb24nLCAoKSA9PiB7XG4gICAgICBsZXQgdXBkYXRlZENvbGxlY3Rpb246IENvbGxlY3Rpb24gPSB7IGlkOiAxLCBuYW1lOiAnRG9nJywgb3duZXI6IDEyLCBsYXN0VXBkYXRlZDogbnVsbCwgY3JlYXRlZE9uOiBudWxsLCBzaXRlTmFtZTogJ2NvcmUnIH07XG4gICAgICBzdG9yZVVuZGVyVGVzdC51cGRhdGUodXBkYXRlZENvbGxlY3Rpb24pO1xuXG4gICAgICBleHBlY3QobW9ja1N0b3JlLmRpc3BhdGNoKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7IHR5cGU6ICdVUERBVEVfQ09MTEVDVElPTicsIHBheWxvYWQ6IHVwZGF0ZWRDb2xsZWN0aW9uIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgncmVwbGFjZUFsbENvbGxlY3Rpb25zV2l0aCgpJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmVwbGFjZSB3aXRoIHRoZSBpdGVtcyBwYXNzZWQgaW4nLCAoKSA9PiB7XG4gICAgICBsZXQgY29sbGVjdGlvbjogQ29sbGVjdGlvbiA9IHsgaWQ6IDEsIG5hbWU6ICdEb2dzJywgb3duZXI6IDEyLCBsYXN0VXBkYXRlZDogbnVsbCwgY3JlYXRlZE9uOiBudWxsLCBzaXRlTmFtZTogJ2NvcmUnIH07XG4gICAgICBsZXQgcmVwbGFjZW1lbnRzOiBhbnkgPSB7XG4gICAgICAgIGl0ZW1zOiBbY29sbGVjdGlvbl0sIHRvdGFsQ291bnQ6IDEsIGN1cnJlbnRQYWdlOiAwLFxuICAgICAgICBoYXNOZXh0UGFnZTogZmFsc2UsIGhhc1ByZXZpb3VzUGFnZTogZmFsc2UsIG51bWJlck9mUGFnZXM6IDEsIHBhZ2VTaXplOiAxXG4gICAgICB9O1xuICAgICAgc3RvcmVVbmRlclRlc3QucmVwbGFjZUFsbENvbGxlY3Rpb25zV2l0aChyZXBsYWNlbWVudHMpO1xuXG4gICAgICBleHBlY3QobW9ja1N0b3JlLmRpc3BhdGNoKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHR5cGU6ICdSRVBMQUNFX0NPTExFQ1RJT05TJyxcbiAgICAgICAgcGF5bG9hZDoge1xuICAgICAgICAgIGl0ZW1zOiBbY29sbGVjdGlvbl0sXG4gICAgICAgICAgcGFnaW5hdGlvbjogeyB0b3RhbENvdW50OiAxLCBjdXJyZW50UGFnZTogMSwgaGFzTmV4dFBhZ2U6IGZhbHNlLCBoYXNQcmV2aW91c1BhZ2U6IGZhbHNlLCBudW1iZXJPZlBhZ2VzOiAxLCBwYWdlU2l6ZTogMSB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXBsYWNlIHdpdGggYW4gZW1wdHkgYXJyYXkgaWYgdGhlcmUgYXJlIG5vIGl0ZW1zJywgKCkgPT4ge1xuICAgICAgbGV0IHJlcGxhY2VtZW50czogYW55ID0geyB0b3RhbENvdW50OiAwLCBjdXJyZW50UGFnZTogMCwgaGFzTmV4dFBhZ2U6IGZhbHNlLCBoYXNQcmV2aW91c1BhZ2U6IGZhbHNlLCBudW1iZXJPZlBhZ2VzOiAxLCBwYWdlU2l6ZTogMCB9O1xuICAgICAgc3RvcmVVbmRlclRlc3QucmVwbGFjZUFsbENvbGxlY3Rpb25zV2l0aChyZXBsYWNlbWVudHMpO1xuXG4gICAgICBleHBlY3QobW9ja1N0b3JlLmRpc3BhdGNoKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHR5cGU6ICdSRVBMQUNFX0NPTExFQ1RJT05TJyxcbiAgICAgICAgcGF5bG9hZDoge1xuICAgICAgICAgIGl0ZW1zOiBbXSxcbiAgICAgICAgICBwYWdpbmF0aW9uOiB7IHRvdGFsQ291bnQ6IDAsIGN1cnJlbnRQYWdlOiAxLCBoYXNOZXh0UGFnZTogZmFsc2UsIGhhc1ByZXZpb3VzUGFnZTogZmFsc2UsIG51bWJlck9mUGFnZXM6IDEsIHBhZ2VTaXplOiAwIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXX0=
